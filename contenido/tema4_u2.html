<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    :root {
        --c-red: #ff4757;
        --c-yellow: #ffa502;
        --c-green: #2ed573;
        --c-text: #2f3542;
        --c-glass: rgba(255, 255, 255, 0.25);
        --c-glass-border: rgba(255, 255, 255, 0.5);
        --bg-dark: #1e272e;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

    body {
        margin: 0;
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: var(--bg-dark);
        color: white;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* --- 1. FONDO "AURORA VIVA" --- */
    .aurora-bg {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        z-index: 0; overflow: hidden;
        background: radial-gradient(circle at 50% 50%, #2f3542 0%, #000000 100%);
        transition: background 0.5s;
    }
    
    .blob {
        position: absolute; border-radius: 50%;
        filter: blur(60px); opacity: 0.6;
        animation: floatBlob 20s infinite alternate;
    }
    .b1 { width: 400px; height: 400px; background: var(--c-green); top: -100px; left: -100px; animation-delay: 0s; }
    .b2 { width: 300px; height: 300px; background: var(--c-red); bottom: -50px; right: -50px; animation-delay: -5s; }
    .b3 { width: 250px; height: 250px; background: var(--c-yellow); top: 40%; left: 40%; animation-delay: -10s; }

    @keyframes floatBlob {
        0% { transform: translate(0, 0) scale(1); }
        50% { transform: translate(30px, -50px) scale(1.1); }
        100% { transform: translate(-20px, 40px) scale(0.9); }
    }

    /* --- 2. NAVEGACI√ìN --- */
    .nav-tabs {
        position: relative; z-index: 50;
        display: flex; justify-content: center; gap: 10px;
        padding: 20px;
        background: rgba(0,0,0,0.2); backdrop-filter: blur(10px);
    }
    .tab {
        padding: 8px 16px; border-radius: 20px;
        background: rgba(255,255,255,0.1); cursor: pointer;
        font-size: 0.9rem; font-weight: bold; transition: 0.3s;
        border: 1px solid transparent;
    }
    .tab.active { background: white; color: var(--c-text); transform: scale(1.05); }

    /* --- 3. CONTENEDOR CENTRAL --- */
    .stage {
        flex-grow: 1; position: relative; z-index: 10;
        display: flex; justify-content: center; align-items: center;
        perspective: 1000px; overflow: hidden;
    }

    /* --- FASE 1: TIPOLOG√çAS (CARRUSEL 3D) --- */
    #phase1 { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
    
    .carousel-container {
        position: relative; width: 300px; height: 450px;
        transform-style: preserve-3d;
        transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .info-card {
        position: absolute; width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        border: 1px solid var(--c-glass-border);
        border-radius: 20px; padding: 25px;
        display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        transition: all 0.5s; cursor: pointer;
    }
    
    .info-card h3 { color: #fff; font-size: 1.5rem; margin-bottom: 15px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    .info-card p { font-size: 1rem; line-height: 1.6; color: #eee; }
    .card-icon { font-size: 3rem; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.5)); }

    /* Controladores del carrusel */
    .carousel-controls {
        position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; z-index: 20; pointer-events: none;
    }
    .arrow-btn {
        pointer-events: auto; background: white; color: black; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .arrow-btn:hover { transform: scale(1.1); }

    /* --- FASE 2: EL SEM√ÅFORO (SWIPE GAME) --- */
    #phase2 { display: none; width: 100%; height: 100%; align-items: center; justify-content: center; flex-direction: column; }

    .game-zone {
        position: relative; width: 320px; height: 480px;
    }

    .swipe-card {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: white; border-radius: 20px;
        color: var(--c-text); padding: 30px;
        display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
        box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        transform-origin: 50% 100%;
        transition: transform 0.1s linear; /* R√°pido para drag */
        cursor: grab;
    }
    .swipe-card.flying { transition: transform 0.5s ease-out, opacity 0.5s; }

    .scenario-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; line-height: 1.4; }
    
    /* Indicadores de Zona */
    .zone-indicator {
        position: absolute; font-weight: bold; font-size: 2rem; opacity: 0; transition: 0.3s;
        text-shadow: 0 2px 10px rgba(0,0,0,0.5); pointer-events: none;
    }
    .zone-left { left: 20px; top: 50%; color: var(--c-red); transform: translateY(-50%) rotate(-15deg); }
    .zone-right { right: 20px; top: 50%; color: var(--c-green); transform: translateY(-50%) rotate(15deg); }
    .zone-top { top: 40px; left: 50%; color: var(--c-yellow); transform: translateX(-50%); }

    /* Botones de control manual (para accesibilidad/PC) */
    .game-controls {
        margin-top: 30px; display: flex; gap: 20px; z-index: 20;
    }
    .btn-game {
        width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 1.5rem;
        cursor: pointer; transition: 0.3s; display: flex; justify-content: center; align-items: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3); background: white;
    }
    .btn-red { color: var(--c-red); border: 2px solid var(--c-red); }
    .btn-yellow { color: var(--c-yellow); border: 2px solid var(--c-yellow); }
    .btn-green { color: var(--c-green); border: 2px solid var(--c-green); }
    .btn-game:hover { transform: scale(1.1); background: currentColor; color: white; }

    /* --- MODAL DE FEEDBACK (Discusi√≥n Guiada) --- */
    .feedback-overlay {
        position: absolute; top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.85); z-index: 100;
        display: none; justify-content: center; align-items: center; padding: 20px;
        backdrop-filter: blur(5px);
    }
    
    .feedback-card {
        background: white; color: #333; padding: 30px; border-radius: 15px;
        max-width: 500px; width: 100%; text-align: center;
        animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border-top: 8px solid #333;
    }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .feedback-badge {
        display: inline-block; padding: 5px 15px; border-radius: 20px;
        color: white; font-weight: bold; margin-bottom: 15px; font-size: 0.9rem;
    }
    .bg-red { background: var(--c-red); }
    .bg-yellow { background: var(--c-yellow); }
    .bg-green { background: var(--c-green); }

    .discussion-list { text-align: left; background: #f1f2f6; padding: 15px; border-radius: 10px; margin: 15px 0; font-size: 0.9rem; }
    .discussion-list li { margin-bottom: 8px; list-style: none; padding-left: 10px; border-left: 3px solid #ccc; }

    /* --- RESPONSIVE --- */
    @media (max-width: 600px) {
        .carousel-container { width: 85%; height: 400px; }
        .game-zone { width: 90%; height: 420px; }
        .swipe-card { padding: 20px; }
        .scenario-text { font-size: 1rem; }
        .btn-game { width: 50px; height: 50px; }
    }

</style>
</head>
<body>

    <!-- FONDO -->
    <div class="aurora-bg">
        <div class="blob b1"></div>
        <div class="blob b2"></div>
        <div class="blob b3"></div>
    </div>

    <!-- NAVEGACI√ìN -->
    <div class="nav-tabs">
        <div class="tab active" onclick="switchPhase(1)">1. TIPOLOG√çAS</div>
        <div class="tab" onclick="switchPhase(2)">2. JUEGO SEM√ÅFORO</div>
    </div>

    <!-- ESCENARIO -->
    <div class="stage">

        <!-- FASE 1: CARRUSEL DE TEOR√çA -->
        <div id="phase1">
            
            <div class="carousel-container" id="carousel">
                <!-- Las tarjetas se inyectan con JS -->
            </div>

            <div class="carousel-controls">
                <div class="arrow-btn" onclick="rotateCarousel(-1)">&#8592;</div>
                <div class="arrow-btn" onclick="rotateCarousel(1)">&#8594;</div>
            </div>
            
            <div style="position: absolute; bottom: 100px; width: 100%; text-align: center; pointer-events: none;">
                <p style="font-size: 0.9rem; opacity: 0.8;">Desliza o usa las flechas para explorar las tipolog√≠as.</p>
            </div>
        </div>

        <!-- FASE 2: JUEGO SEM√ÅFORO -->
        <div id="phase2">
            
            <div class="zone-indicator zone-left" id="ind-left">VIOLENCIA (ROJO)</div>
            <div class="zone-indicator zone-top" id="ind-top">RIESGO (AMARILLO)</div>
            <div class="zone-indicator zone-right" id="ind-right">SANO (VERDE)</div>

            <div class="game-zone" id="card-stack">
                <!-- Tarjeta del juego aqu√≠ -->
                <div class="swipe-card" id="active-card">
                    <div style="font-size:3rem; margin-bottom:20px;">üÉè</div>
                    <div class="scenario-text" id="card-text">Cargando situaci√≥n...</div>
                    <div style="color:#aaa; font-size:0.8rem; margin-top:20px;">Arrastra la tarjeta: <br>‚¨Ö Rojo | ‚¨Ü Amarillo | ‚û° Verde</div>
                </div>
            </div>

            <div class="game-controls">
                <button class="btn-game btn-red" onclick="manualSwipe('left')">üî¥</button>
                <button class="btn-game btn-yellow" onclick="manualSwipe('up')">üü°</button>
                <button class="btn-game btn-green" onclick="manualSwipe('right')">üü¢</button>
            </div>

        </div>

    </div>

    <!-- MODAL DE DISCUSI√ìN -->
    <div class="feedback-overlay" id="feedback-modal">
        <div class="feedback-card">
            <div id="fb-badge" class="feedback-badge">CLASIFICACI√ìN</div>
            <h3 id="fb-title">T√çTULO</h3>
            <div class="discussion-list">
                <ul>
                    <li><strong>Tipo de Violencia:</strong> <span id="fb-type">...</span></li>
                    <li><strong>Contexto:</strong> <span id="fb-context">...</span></li>
                    <li><strong>Acci√≥n Preventiva:</strong> <span id="fb-action">...</span></li>
                </ul>
            </div>
            <p id="fb-msg"></p>
            <button onclick="closeModal()" style="background:#2f3542; color:white; border:none; padding:12px 30px; border-radius:20px; font-weight:bold; cursor:pointer; margin-top:10px;">CONTINUAR</button>
        </div>
    </div>

<script>
    // --- DATOS DEL CONTENIDO (NO MODIFICADOS) ---
    const typologies = [
        { icon: "üëä", title: "VIOLENCIA F√çSICA", text: "Agresiones que generan da√±o corporal." },
        { icon: "üß†", title: "VIOLENCIA PSICOL√ìGICA", text: "Intimidaci√≥n, amenazas, control y aislamiento." },
        { icon: "üí∏", title: "VIOLENCIA ECON√ìMICA", text: "Control o limitaci√≥n de recursos." },
        { icon: "üé≠", title: "VIOLENCIA SIMB√ìLICA", text: "Estereotipos y pr√°cticas que reproducen desigualdad." },
        { icon: "üö´", title: "VIOLENCIA SEXUAL", text: "Actos sexuales sin consentimiento." }
    ];

    // Situaciones para el juego (Basadas en las tipolog√≠as para el ejercicio)
    const situations = [
        {
            text: "Tu pareja controla cu√°nto dinero gastas y te pide recibos de todo.",
            correct: "red", // O yellow, depende de la gravedad, pondremos red por control
            type: "Violencia Econ√≥mica",
            context: "√Åmbito dom√©stico / Relaci√≥n de pareja",
            action: "Activar ruta de atenci√≥n, fortalecer autonom√≠a econ√≥mica."
        },
        {
            text: "Un compa√±ero hace chistes sexistas sobre las mujeres en la oficina.",
            correct: "yellow", // Alerta, simb√≥lica
            type: "Violencia Simb√≥lica",
            context: "Entorno Laboral / Institucional",
            action: "Sanci√≥n social, pedagog√≠a, revisi√≥n de c√≥digos de conducta."
        },
        {
            text: "Se toman decisiones conjuntas respetando la opini√≥n de ambos.",
            correct: "green",
            type: "Relaci√≥n Sana",
            context: "Convivencia",
            action: "Fortalecer la comunicaci√≥n asertiva."
        },
        {
            text: "Amenazas con da√±ar a tus seres queridos si no haces lo que se te pide.",
            correct: "red",
            type: "Violencia Psicol√≥gica",
            context: "Coacci√≥n / Intimidaci√≥n",
            action: "Medida de protecci√≥n inmediata, denuncia penal."
        }
    ];

    // --- FASE 1: CARRUSEL ---
    let currIndex = 0;
    const carousel = document.getElementById('carousel');

    function initCarousel() {
        typologies.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'info-card';
            // Posicionamiento inicial apilado
            card.innerHTML = `<div class="card-icon">${item.icon}</div><h3>${item.title}</h3><p>${item.text}</p>`;
            card.style.opacity = index === 0 ? 1 : 0;
            card.style.zIndex = index === 0 ? 10 : 0;
            carousel.appendChild(card);
        });
        updateCarousel();
    }

    function rotateCarousel(dir) {
        currIndex += dir;
        if (currIndex < 0) currIndex = typologies.length - 1;
        if (currIndex >= typologies.length) currIndex = 0;
        updateCarousel();
    }

    function updateCarousel() {
        const cards = carousel.children;
        for (let i = 0; i < cards.length; i++) {
            cards[i].style.opacity = i === currIndex ? 1 : 0;
            cards[i].style.transform = i === currIndex ? "scale(1) translateZ(0)" : "scale(0.8) translateZ(-100px)";
            cards[i].style.zIndex = i === currIndex ? 10 : 0;
        }
    }

    // --- FASE 2: JUEGO SWIPE ---
    let currentCardIndex = 0;
    const cardEl = document.getElementById('active-card');
    const cardText = document.getElementById('card-text');
    let startX, startY, isDragging = false;

    function loadCard() {
        if (currentCardIndex >= situations.length) {
            cardText.innerText = "¬°Ejercicio Completado!";
            cardEl.style.transform = "none";
            return;
        }
        cardText.innerText = situations[currentCardIndex].text;
        cardEl.style.transform = "translate(0, 0) rotate(0deg)";
        cardEl.style.opacity = 1;
        cardEl.className = "swipe-card"; // Reset classes
        
        // Reset indicators
        document.getElementById('ind-left').style.opacity = 0;
        document.getElementById('ind-right').style.opacity = 0;
        document.getElementById('ind-top').style.opacity = 0;
    }

    // Touch/Mouse Events
    cardEl.addEventListener('mousedown', startDrag);
    cardEl.addEventListener('touchstart', startDrag);

    function startDrag(e) {
        if (currentCardIndex >= situations.length) return;
        isDragging = true;
        startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
        cardEl.style.transition = "none";
        
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('touchmove', onDrag);
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);
    }

    function onDrag(e) {
        if (!isDragging) return;
        const currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        const currentY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
        
        const deltaX = currentX - startX;
        const deltaY = currentY - startY;
        const rotate = deltaX * 0.1;

        cardEl.style.transform = `translate(${deltaX}px, ${deltaY}px) rotate(${rotate}deg)`;

        // Visual Feedback Indicators
        document.getElementById('ind-left').style.opacity = deltaX < -50 ? 1 : 0;
        document.getElementById('ind-right').style.opacity = deltaX > 50 ? 1 : 0;
        document.getElementById('ind-top').style.opacity = deltaY < -50 ? 1 : 0;
    }

    function endDrag(e) {
        if (!isDragging) return;
        isDragging = false;
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('touchmove', onDrag);
        document.removeEventListener('mouseup', endDrag);
        document.removeEventListener('touchend', endDrag);

        const matrix = new WebKitCSSMatrix(window.getComputedStyle(cardEl).transform);
        const x = matrix.m41;
        const y = matrix.m42;

        if (x > 100) processChoice('green');       // Derecha
        else if (x < -100) processChoice('red');   // Izquierda
        else if (y < -100) processChoice('yellow');// Arriba
        else {
            // Reset position
            cardEl.style.transition = "transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
            cardEl.style.transform = "translate(0, 0) rotate(0deg)";
            resetIndicators();
        }
    }

    function manualSwipe(color) {
        if (currentCardIndex >= situations.length) return;
        
        let x = 0, y = 0, r = 0;
        if (color === 'red') { x = -500; r = -30; }
        if (color === 'green') { x = 500; r = 30; }
        if (color === 'yellow') { y = -500; }

        cardEl.classList.add('flying');
        cardEl.style.transform = `translate(${x}px, ${y}px) rotate(${r}deg)`;
        cardEl.style.opacity = 0;

        setTimeout(() => processChoice(color, true), 300);
    }

    function processChoice(color, manual = false) {
        resetIndicators();
        const situation = situations[currentCardIndex];
        
        // Show Feedback Modal
        showFeedback(situation, color);

        currentCardIndex++;
        // Load next card happens after modal closes
    }

    function showFeedback(data, userColor) {
        const modal = document.getElementById('feedback-modal');
        const badge = document.getElementById('fb-badge');
        
        modal.style.display = 'flex';
        
        document.getElementById('fb-title').innerText = userColor === data.correct ? "¬°CLASIFICACI√ìN CORRECTA!" : "REVISI√ìN NECESARIA";
        document.getElementById('fb-type').innerText = data.type;
        document.getElementById('fb-context').innerText = data.context;
        document.getElementById('fb-action').innerText = data.action;

        // Estilos seg√∫n respuesta correcta real
        badge.className = 'feedback-badge';
        if(data.correct === 'red') { badge.classList.add('bg-red'); badge.innerText = "VIOLENCIA GRAVE"; }
        if(data.correct === 'yellow') { badge.classList.add('bg-yellow'); badge.innerText = "ALERTA DE RIESGO"; }
        if(data.correct === 'green') { badge.classList.add('bg-green'); badge.innerText = "RELACI√ìN SANA"; }
        
        // Cambiar fondo aurora seg√∫n resultado
        if(userColor === data.correct) {
            document.querySelector('.aurora-bg').style.filter = "hue-rotate(90deg)"; // Efecto √©xito visual
        } else {
            document.querySelector('.aurora-bg').style.filter = "grayscale(100%)"; // Efecto error
        }
    }

    function closeModal() {
        document.getElementById('feedback-modal').style.display = 'none';
        document.querySelector('.aurora-bg').style.filter = "none";
        loadCard();
    }

    function resetIndicators() {
        document.getElementById('ind-left').style.opacity = 0;
        document.getElementById('ind-right').style.opacity = 0;
        document.getElementById('ind-top').style.opacity = 0;
    }

    function switchPhase(n) {
        document.getElementById('phase1').style.display = n === 1 ? 'flex' : 'none';
        document.getElementById('phase2').style.display = n === 2 ? 'flex' : 'none';
        
        document.querySelectorAll('.tab').forEach((t, i) => {
            t.classList.toggle('active', i + 1 === n);
        });
    }

    // Init
    initCarousel();
    loadCard();

</script>

</body>
</html>