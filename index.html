<!-- ESTILOS (CSS) -->
<style>
    /* --- ESTRUCTURA PRINCIPAL --- */
    .sim-wrapper {
        font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif;
        max-width: 450px;
        margin: 0 auto;
        position: relative;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        background: #f0f2f5;
        height: 700px; /* Altura fija para contener todas las pantallas */
    }

    /* --- PANTALLA 1: ADVERTENCIA --- */
    .screen-warning {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(30, 30, 30, 0.98);
        color: white;
        z-index: 100;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 30px;
        text-align: center;
        box-sizing: border-box;
    }
    .warn-icon { font-size: 40px; margin-bottom: 20px; }
    .warn-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; color: #ffcc00; }
    .warn-text { font-size: 14px; line-height: 1.6; margin-bottom: 30px; color: #ddd; }
    .btn-start {
        background: #ffcc00; color: #000; border: none;
        padding: 12px 30px; border-radius: 25px;
        font-weight: bold; cursor: pointer; transition: 0.3s;
    }
    .btn-start:hover { transform: scale(1.05); background: #ffd633; }

    /* --- PANTALLA 2: CHAT (SIMULADOR) --- */
    .screen-chat {
        display: none; /* Oculto inicialmente */
        flex-direction: column;
        height: 100%;
        position: relative;
    }
    .chat-header {
        background: #008069; color: white; padding: 12px 15px;
        display: flex; align-items: center; gap: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .avatar {
        width: 40px; height: 40px; border-radius: 50%;
        background: url('https://ui-avatars.com/api/?name=Alex&background=fff&color=008069&bold=true');
        background-size: cover;
    }
    .chat-body {
        flex: 1; padding: 15px; overflow-y: auto;
        display: flex; flex-direction: column; gap: 10px;
        background-color: #e5ddd5;
        background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
        background-size: 20px 20px;
    }
    
    /* Burbujas */
    .bubble {
        max-width: 80%; padding: 10px 14px; border-radius: 12px;
        font-size: 14px; line-height: 1.4; position: relative;
        animation: slideUp 0.3s ease;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    .inc { background: #fff; align-self: flex-start; border-top-left-radius: 0; }
    .out { background: #d9fdd3; align-self: flex-end; border-top-right-radius: 0; }
    
    /* Mensajes del Sistema (Educativos) */
    .sys-msg {
        align-self: center; text-align: center;
        background: #e3f2fd; color: #0d47a1;
        border: 1px solid #bbdefb;
        padding: 8px 12px; border-radius: 8px;
        font-size: 12px; margin: 10px 0;
        width: 90%;
    }
    .col-badge {
        display: inline-block; background: #FFCD00; color: #003087;
        font-weight: bold; font-size: 10px; padding: 2px 5px;
        border-radius: 4px; margin-right: 5px; vertical-align: middle;
    }

    /* Violent√≥metro Visual */
    .v-controls { background: #f0f2f5; padding: 0; border-top: 1px solid #ddd; }
    .meter-box { padding: 10px 20px; background: #fff; }
    .meter-title { font-size: 11px; font-weight: bold; color: #666; display: flex; justify-content: space-between; margin-bottom: 5px; }
    .track { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; width: 0%; transition: width 0.5s, background 0.5s; }
    
    /* Botones Opciones */
    .opts-box { padding: 10px 15px 20px; display: flex; flex-direction: column; gap: 8px; }
    .opt-btn {
        background: white; border: 1px solid #ccc; padding: 12px;
        border-radius: 8px; cursor: pointer; text-align: left;
        font-size: 14px; transition: 0.2s; color: #333;
    }
    .opt-btn:hover { border-color: #008069; color: #008069; background: #f9f9f9; }

    /* --- PANTALLA 3: REFLEXI√ìN (FINAL) --- */
    .screen-reflection {
        display: none;
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: white; z-index: 50;
        padding: 30px; box-sizing: border-box;
        overflow-y: auto;
    }
    .ref-header { text-align: center; margin-bottom: 25px; }
    .ref-title { color: #d32f2f; font-size: 22px; font-weight: bold; margin: 0; }
    .ref-subtitle { color: #555; font-size: 14px; margin-top: 5px; }
    
    .ref-card {
        background: #f9f9f9; border-left: 4px solid #008069;
        padding: 15px; margin-bottom: 15px; border-radius: 4px;
    }
    .ref-q { font-weight: bold; color: #333; margin-bottom: 8px; font-size: 15px; }
    .ref-a { font-size: 14px; color: #555; line-height: 1.5; }
    
    .alert-box {
        background: #fff3e0; border: 1px solid #ffe0b2;
        padding: 15px; border-radius: 8px; text-align: center;
        margin-top: 20px;
    }
    .alert-text { font-size: 13px; color: #e65100; margin-bottom: 5px; }
    .help-lines { font-weight: bold; font-size: 16px; color: #333; }

    /* Animaciones */
    @keyframes slideUp { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
    .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

</style>

<!-- ESTRUCTURA HTML -->
<div class="sim-wrapper" id="app">

    <!-- 1. PANTALLA DE ADVERTENCIA -->
    <div class="screen-warning" id="screen-warn">
        <div class="warn-icon">‚ö†Ô∏è</div>
        <div class="warn-title">Advertencia de Contenido Sensible</div>
        <div class="warn-text">
            Esta simulaci√≥n contiene situaciones de <b>violencia psicol√≥gica, manipulaci√≥n y control</b> basadas en casos reales.<br><br>
            Su objetivo es pedag√≥gico. Si este contenido te resulta dif√≠cil o remueve traumas pasados, por favor detente.<br><br>
            <b>Normativa:</b> Basado en la Ley 1257 de 2008 (Colombia) sobre el derecho de las mujeres a una vida libre de violencias.
        </div>
        <button class="btn-start" onclick="irAlChat()">Entendido, Continuar</button>
    </div>

    <!-- 2. PANTALLA DEL CHAT -->
    <div class="screen-chat" id="screen-chat">
        <div class="chat-header">
            <div class="avatar"></div>
            <div>
                <div style="font-weight:700; font-size:15px;">Alex (Amor ‚ù§Ô∏è)</div>
                <div style="font-size:12px; opacity:0.9;">En l√≠nea</div>
            </div>
        </div>

        <div class="chat-body" id="chat-msgs">
            <div style="text-align:center; font-size:11px; color:#888; margin-bottom:10px;">Hoy</div>
            <!-- Los mensajes se generan con JS -->
        </div>

        <div class="v-controls">
            <!-- Violent√≥metro -->
            <div class="meter-box">
                <div class="meter-title">
                    <span>Nivel de Riesgo</span>
                    <span id="meter-txt" style="color:#4caf50">Bajo</span>
                </div>
                <div class="track"><div class="fill" id="meter-bar" style="background:#4caf50"></div></div>
            </div>
            <!-- Opciones -->
            <div class="opts-box" id="chat-opts">
                <!-- Botones JS -->
            </div>
        </div>
    </div>

    <!-- 3. PANTALLA DE REFLEXI√ìN (FINAL) -->
    <div class="screen-reflection" id="screen-ref">
        <div class="ref-header">
            <h2 class="ref-title">Reflexi√≥n Final</h2>
            <p class="ref-subtitle">Analicemos lo que acaba de pasar.</p>
        </div>

        <div class="ref-card">
            <div class="ref-q">1. ¬øEn qu√© momento empez√≥ la violencia?</div>
            <div class="ref-a">
                No fue al final con los gritos. Empez√≥ en la <b>Zona Amarilla</b> con el comentario sobre el vestido. <br>
                <i>En Colombia, la Ley 1257 define esto como violencia psicol√≥gica al intentar controlar tus decisiones.</i>
            </div>
        </div>

        <div class="ref-card">
            <div class="ref-q">2. "Frases Trampa" identificadas:</div>
            <div class="ref-a">
                ‚ùå "Lo digo por cuidarte" (Disfraz de protecci√≥n).<br>
                ‚ùå "Est√°s loca / exageras" (Luz de Gas / Gaslighting).<br>
                ‚ùå "Si te quisiera otro no te aguantar√≠a" (Destrucci√≥n de autoestima).
            </div>
        </div>

        <div class="alert-box">
            <div class="alert-text">
                <b>NO ES TU CULPA.</b><br>
                Este tipo de situaciones no son aisladas ni ocurren por "malas decisiones" de la v√≠ctima. Es un ciclo estructural.
            </div>
            <hr style="border:0; border-top:1px solid #ffe0b2; margin:10px 0;">
            <div style="font-size:14px; margin-bottom:5px; color:#333;">Canales de Ayuda en Colombia:</div>
            <div class="help-lines">üìû L√≠nea 155 (Orientaci√≥n Nacional)</div>
            <div class="help-lines">üìû L√≠nea 123 (Emergencias)</div>
            <div style="font-size:11px; margin-top:5px; color:#666;">Fiscal√≠a General: L√≠nea 122</div>
        </div>
        
        <div style="text-align:center; margin-top:20px;">
            <button class="btn-start" style="background:#ddd; font-size:12px;" onclick="location.reload()">Reiniciar Simulaci√≥n</button>
        </div>
    </div>

</div>

<!-- L√ìGICA DE PROGRAMACI√ìN (JS) -->
<script>
    // --- DATOS Y GUION ---
    const historia = {
        'inicio': {
            msgs: ["Hola amor. ¬øYa vas saliendo del trabajo?", "Vi que te pusiste esa blusa escotada..."],
            opts: [
                { txt: "S√≠, ya sal√≠. ¬øNo te gusta la blusa?", ir: 'control_ropa', val: 20 },
                { txt: "Hola. S√≠, me siento linda hoy.", ir: 'gaslight_inicio', val: 30 }
            ]
        },
        'control_ropa': {
            msgs: ["No es que no me guste. Es que te ves muy 'ofrecida'.", "Sabes c√≥mo son los tipos en la calle. Lo digo para que te respeten."],
            sys: "‚ö†Ô∏è ZONA AMARILLA: El control de la vestimenta es una forma sutil de violencia. Limita tu libre desarrollo de la personalidad.",
            opts: [
                { txt: "Tienes raz√≥n, perd√≥n.", ir: 'fase_celos', val: 45 },
                { txt: "Yo me visto como quiera, exijo respeto.", ir: 'fase_agresiva', val: 50 }
            ]
        },
        'gaslight_inicio': {
            msgs: ["Uy, qu√© modesta.", "√öltimamente te crees mucho, ¬øno? Seguro es por esas amigas tuyas."],
            sys: "‚ö†Ô∏è ZONA AMARILLA: Aislarte de tus redes de apoyo (amigas/familia) es una estrategia de control.",
            opts: [
                { txt: "Mis amigas no tienen la culpa.", ir: 'fase_celos', val: 40 },
                { txt: "(Ignorar mensaje)", ir: 'fase_agresiva', val: 60 }
            ]
        },
        'fase_celos': {
            msgs: ["Como sea. M√°ndame tu ubicaci√≥n en tiempo real.", "Y quiero la clave de tu celular. El que nada debe, nada teme."],
            sys: "üõë ZONA NARANJA (Delito): En Colombia, exigir claves o revisar el celular viola el Derecho a la Intimidad (Sentencia T-058/23).",
            opts: [
                { txt: "No te voy a dar mi clave.", ir: 'fase_amenaza', val: 75 },
                { txt: "Est√° bien, toma, pero no te enojes.", ir: 'ciclo_luna_miel', val: 70 }
            ]
        },
        'fase_agresiva': {
            msgs: ["¬øAh s√≠? ¬øAhora eres muy alzada?", "Eres una malagradecida. Con todo lo que hago por ti.", "Est√°s loca, nena."],
            sys: "‚ö†Ô∏è LUZ DE GAS (Gaslighting): Te hace dudar de tu cordura para invalidar tu defensa.",
            opts: [
                { txt: "No estoy loca, basta.", ir: 'fase_amenaza', val: 80 }
            ]
        },
        'fase_amenaza': {
            msgs: ["Cuidado con lo que haces.", "Si te veo con otro, no respondo.", "Voy para all√° y vamos a arreglar esto a las malas."],
            sys: "üÜò ZONA ROJA: Amenazas directas. En este punto, tu integridad f√≠sica corre peligro. ¬°Llama al 123 o 155!",
            opts: [
                { txt: "üö´ FINALIZAR Y REFLEXIONAR", ir: 'fin_reflexion', val: 100 }
            ]
        },
        'ciclo_luna_miel': {
            msgs: ["Gracias beb√©. Sabes que soy as√≠ porque te amo demasiado.", "Nadie te va a cuidar como yo."],
            sys: "üîÑ CICLO DE VIOLENCIA: La 'Reconciliaci√≥n' es temporal. Si cediste al control, la violencia volver√° a escalar.",
            opts: [
                { txt: "‚û°Ô∏è IR A LA REFLEXI√ìN", ir: 'fin_reflexion', val: 60 }
            ]
        }
    };

    // --- VARIABLES DOM ---
    const chatBody = document.getElementById('chat-msgs');
    const optsDiv = document.getElementById('chat-opts');
    const meterBar = document.getElementById('meter-bar');
    const meterTxt = document.getElementById('meter-txt');
    const appBox = document.getElementById('app');

    // --- FUNCIONES ---

    function irAlChat() {
        document.getElementById('screen-warn').style.display = 'none';
        document.getElementById('screen-chat').style.display = 'flex';
        renderEscena('inicio');
    }

    function irAReflexion() {
        document.getElementById('screen-chat').style.display = 'none';
        document.getElementById('screen-ref').style.display = 'block';
    }

    function renderEscena(id) {
        if(id === 'fin_reflexion') {
            irAReflexion();
            return;
        }

        optsDiv.innerHTML = ''; // Limpiar opciones
        const escena = historia[id];
        let delay = 0;

        escena.msgs.forEach((txt, i) => {
            delay += 1200 + (txt.length * 20); // Tiempo lectura
            
            setTimeout(() => {
                const b = document.createElement('div');
                b.className = 'bubble inc';
                b.innerText = txt;
                chatBody.appendChild(b);
                chatBody.scrollTop = chatBody.scrollHeight;
                
                // Efecto vibraci√≥n si es agresivo
                if(id.includes('amenaza') || id.includes('agresiva')) {
                    appBox.classList.add('shake');
                    setTimeout(()=>appBox.classList.remove('shake'), 500);
                }

                // Si es el ultimo, ver si hay nota del sistema
                if(i === escena.msgs.length - 1) {
                    if(escena.sys) {
                        setTimeout(() => {
                            const s = document.createElement('div');
                            s.className = 'sys-msg';
                            s.innerHTML = `<span class="col-badge">COL</span> ${escena.sys}`;
                            chatBody.appendChild(s);
                            chatBody.scrollTop = chatBody.scrollHeight;
                        }, 600);
                    }
                    setTimeout(() => mostrarOpciones(escena.opts), 800);
                }
            }, delay);
        });
    }

    function mostrarOpciones(opts) {
        opts.forEach(o => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = o.txt;
            btn.onclick = () => {
                // Agregar mi respuesta
                const b = document.createElement('div');
                b.className = 'bubble out';
                b.innerText = o.txt;
                chatBody.appendChild(b);
                
                actualizarViolentometro(o.val);
                renderEscena(o.ir);
            };
            optsDiv.appendChild(btn);
        });
    }

    function actualizarViolentometro(val) {
        meterBar.style.width = val + '%';
        
        let color = '#4caf50'; // Verde
        let texto = 'Bajo / "Normal"';

        if(val > 30) { color = '#ffeb3b'; texto = 'Amarillo: Cuidado'; }
        if(val > 50) { color = '#ff9800'; texto = 'Naranja: Reacciona'; }
        if(val > 75) { color = '#f44336'; texto = 'Rojo: ¬°PELIGRO!'; }

        meterBar.style.background = color;
        meterTxt.innerText = texto;
        meterTxt.style.color = (val > 30) ? '#d32f2f' : '#4caf50';
    }

</script>