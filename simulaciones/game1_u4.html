<!-- LIBRER√çAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<!-- Fuentes institucionales -->
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
/* --- VARIABLES DE IDENTIDAD --- */
:root {
    /* Paleta Imagen */
    --tf-purple: #4B1E7A;          
    --tf-orange: #E35205;          
    --tf-yellow: #FDB913;          
    --tf-success: #00A499;         
    
    --bg-main: #FFFFFF;            
    --text-main: #333333;          
    
    --card-shadow: 0 8px 20px rgba(75, 30, 122, 0.1);
    --border-radius: 16px;
}

#policy-repair-station {
    width: 100%;
    min-height: 850px;
    height: auto;
    background: linear-gradient(180deg, #FFFFFF 0%, #F3E5F5 100%) !important;
    font-family: 'Inter', sans-serif;
    color: var(--text-main) !important;
    border: 1px solid #e0e0e0 !important;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    position: relative;
    overflow: hidden;
}

/* --- LOGOS --- */
.header-logos {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 20px;
    padding: 0 10px;
    z-index: 10;
}

.header-logos img {
    height: 55px; 
    width: auto;
    object-fit: contain;
    transition: transform 0.3s ease;
}

/* --- HEADER INSTRUCTIVO --- */
.station-header {
    text-align: center;
    border-bottom: none;
    padding-bottom: 10px;
    margin-bottom: 20px;
}
.station-title {
    font-family: 'Sora', sans-serif;
    font-size: clamp(1.5rem, 4vw, 2.2rem);
    color: var(--tf-purple) !important;
    font-weight: 800;
    margin: 0 0 10px 0;
    text-transform: none;
    line-height: 1.2;
}
.station-desc {
    color: #555 !important; 
    font-size: 1rem;
    background: white; 
    border: 1px solid #eee;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    display: inline-block; 
    padding: 10px 25px; 
    border-radius: 30px;
    font-weight: 600;
}

/* --- ZONA DE FALLAS (ALERTAS) --- */
.failures-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.failure-card {
    background-color: white !important;
    border: 2px solid var(--tf-orange) !important; 
    border-radius: var(--border-radius);
    padding: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: flex; flex-direction: column; align-items: center; text-align: center;
    opacity: 1 !important;
    box-shadow: var(--card-shadow);
}
.failure-card:hover { 
    transform: translateY(-5px); 
    box-shadow: 0 15px 30px rgba(227, 82, 5, 0.2);
}

/* Estado Resuelto */
.failure-card.repaired {
    border-color: var(--tf-success) !important;
    background-color: #F0FDFA !important; 
    cursor: default; pointer-events: none;
    box-shadow: none;
}

.icon-status { font-size: 3rem; margin-bottom: 10px; }
.card-title { 
    font-family: 'Sora', sans-serif; 
    font-weight: 800; 
    font-size: 1.2rem; 
    margin-bottom: 10px; 
    color: var(--tf-purple) !important;
}
.card-desc { font-size: 0.95rem; color: #666 !important; line-height: 1.5; }

.action-hint { 
    margin-top: 15px; 
    background: var(--tf-orange); 
    color: white; 
    padding: 8px 16px; 
    font-size: 0.8rem; 
    font-weight: bold; 
    border-radius: 20px; 
    text-transform: uppercase;
    letter-spacing: 1px;
}
/* CAMBIO: Texto de √©xito alineado a redefinici√≥n */
.repaired .action-hint { background: var(--tf-success); content: "TRANSFORMADO"; }

/* --- PANEL DE REPARACI√ìN (HERRAMIENTAS) --- */
.repair-console {
    background-color: white !important;
    border: 2px solid var(--tf-purple);
    padding: 30px;
    border-radius: var(--border-radius);
    display: none; 
    animation: slideUp 0.5s ease-out;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.05);
}

.console-title {
    color: var(--tf-purple); 
    font-family: 'Sora', sans-serif; 
    font-weight: 800;
    font-size: 1.3rem; 
    margin-top: 0;
    border-bottom: 1px solid #eee; 
    padding-bottom: 15px; 
    margin-bottom: 20px;
}

.tools-grid {
    display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;
}

.tool-btn {
    background-color: #fff !important;
    color: var(--tf-purple) !important;
    border: 2px solid #e0e0e0 !important;
    padding: 15px 20px;
    border-radius: 12px;
    cursor: pointer;
    flex: 1 1 200px;
    display: flex; align-items: center; gap: 10px;
    transition: 0.2s;
    font-weight: bold;
    font-family: 'Sora', sans-serif;
}
.tool-btn:hover { 
    background-color: var(--tf-purple) !important; 
    border-color: var(--tf-purple) !important;
    color: white !important; 
    transform: scale(1.02);
}
.tool-icon { font-size: 1.5rem; }

/* --- MODAL DE INFORMACI√ìN (SUCCESS) --- */
.info-modal {
    position: absolute; top:0; left:0; width:100%; height:100%;
    background-color: rgba(255, 255, 255, 0.95) !important; 
    z-index: 100;
    display: none; flex-direction: column; justify-content: center; align-items: center;
    padding: 20px; box-sizing: border-box; text-align: center;
    backdrop-filter: blur(5px);
}
.modal-content { 
    max-width: 600px; 
    animation: popIn 0.3s; 
    background: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.1);
    border: 1px solid #eee;
}
.modal-check { font-size: 4rem; color: var(--tf-success); margin-bottom: 20px; display: block; }
.modal-h { 
    font-family: 'Sora', sans-serif; 
    font-weight: 800;
    font-size: 2rem; 
    color: var(--tf-purple); 
    margin: 0 0 20px 0; 
}
.modal-p { font-size: 1.1rem; line-height: 1.6; color: #555; margin-bottom: 30px; }
.modal-btn {
    background: var(--tf-purple); 
    color: white; 
    border: none; 
    padding: 12px 30px;
    font-size: 1rem; 
    font-weight: bold; 
    cursor: pointer; 
    border-radius: 30px;
    transition: 0.3s;
}
.modal-btn:hover { background: var(--tf-orange); transform: scale(1.05); }

/* ANIMACIONES */
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
@keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes pulseAlert { 
    0% { box-shadow: 0 0 0 0 rgba(227, 82, 5, 0.4); } 
    70% { box-shadow: 0 0 0 10px rgba(227, 82, 5, 0); } 
    100% { box-shadow: 0 0 0 0 rgba(227, 82, 5, 0); } 
}

.failure-card:not(.repaired) { animation: pulseAlert 2s infinite; }

@media (max-width: 768px) {
    .header-logos img { height: 40px; }
    .station-title { font-size: 1.5rem; }
}
</style>

<div id="policy-repair-station">
    
    <!-- HEADER CON LOGOS -->
    <div class="header-logos">
        <img src="../Styles/UNP I.svg" alt="Logo UNP">
        <img src="../Styles/logo.png" alt="Logo Comisi√≥n">
    </div>

    <div class="station-header">
        <h2 class="station-title">Misi√≥n 1: Tablero de Control</h2>
        <!-- CAMBIO: "herramienta de reparaci√≥n" por "herramienta de transformaci√≥n" -->
        <div class="station-desc">INSTRUCCIONES: Haz clic en los ALERTAS para activar la herramienta de transformaci√≥n.</div>
    </div>

    <!-- 1. GRILLA DE PROBLEMAS -->
    <div class="failures-grid">
        
        <!-- Falla 1 -->
        <div class="failure-card" id="fail-1" onclick="openRepair(1)">
            <div class="icon-status" id="icon-1">‚ö†Ô∏è</div>
            <div class="card-title">VAC√çO NORMATIVO</div>
            <div class="card-desc">No hay sanciones claras para violencias ni licencias de maternidad definidas.</div>
            <!-- CAMBIO: CLIC PARA REDEFINIR -->
            <div class="action-hint" id="hint-1">¬°CLIC PARA REDEFINIR!</div>
        </div>

        <!-- Falla 2 -->
        <div class="failure-card" id="fail-2" onclick="openRepair(2)">
            <div class="icon-status" id="icon-2">‚ö†Ô∏è</div>
            <div class="card-title">FALTA DE RUMBO</div>
            <div class="card-desc">La instituci√≥n no tiene una hoja de ruta clara para la equidad a largo plazo.</div>
            <!-- CAMBIO: CLIC PARA REDEFINIR -->
            <div class="action-hint" id="hint-2">¬°CLIC PARA REDEFINIR!</div>
        </div>

        <!-- Falla 3 -->
        <div class="failure-card" id="fail-3" onclick="openRepair(3)">
            <div class="icon-status" id="icon-3">‚ö†Ô∏è</div>
            <div class="card-title">SIN RECURSOS</div>
            <div class="card-desc">Hay buenas intenciones, pero no hay dinero asignado espec√≠ficamente para g√©nero.</div>
            <!-- CAMBIO: CLIC PARA REDEFINIR -->
            <div class="action-hint" id="hint-3">¬°CLIC PARA REDEFINIR!</div>
        </div>

    </div>

    <!-- 2. CONSOLA DE TRANSFORMACI√ìN -->
    <div class="repair-console" id="console">
        <div class="console-title" id="console-title">SELECCIONA LA HERRAMIENTA CORRECTA:</div>
        
        <div class="tools-grid">
            <!-- Herramienta A -->
            <div class="tool-btn" onclick="tryFix('norma')">
                <span class="tool-icon">‚öñÔ∏è</span>
                <span>Leyes 1257 y 1822</span>
            </div>
            <!-- Herramienta B -->
            <div class="tool-btn" onclick="tryFix('plan')">
                <span class="tool-icon">üó∫Ô∏è</span>
                <span>CONPES Social 161</span>
            </div>
            <!-- Herramienta C -->
            <div class="tool-btn" onclick="tryFix('presupuesto')">
                <span class="tool-icon">üí∞</span>
                <span>Presupuestos Sensibles (PSG)</span>
            </div>
        </div>
        <div id="console-error" style="color:#E35205; margin-top:15px; font-weight:bold; display:none; text-align:center;">‚ùå HERRAMIENTA INCORRECTA. INTENTA OTRA.</div>
    </div>

    <!-- 3. MODAL DE √âXITO -->
    <div class="info-modal" id="success-modal">
        <div class="modal-content">
            <span class="modal-check">‚úÖ</span>
            <!-- CAMBIO: SISTEMA REDEFINIDO en lugar de REPARADO -->
            <h3 class="modal-h">¬°SISTEMA REDEFINIDO!</h3>
            <p class="modal-p" id="modal-text">...</p>
            <button class="modal-btn" onclick="closeModal()">ENTENDIDO, CONTINUAR</button>
        </div>
    </div>

</div>

<script>
// --- ESTADO ---
let activeProblem = 0; 
let repairsCompleted = 0;

// DATOS EDUCATIVOS - ACTUALIZADOS CON LAS CORRECCIONES
const feedbackData = {
    1: "<strong>Has integrado el Marco Normativo.</strong><br>La Ley 1257 de 2008 y la Ley 1822 de 2017 cubren los vac√≠os legales, proporcionando sanciones y protecci√≥n laboral.",
    
    // CORRECCI√ìN 1: Enfoque epist√©mico aplicado a la Pol√≠tica/Rumbo
    2: "<strong>Has definido la Hoja de Ruta.</strong><br>El CONPES Social 161 define la pol√≠tica p√∫blica nacional de equidad.<br><br>Ahora la instituci√≥n sabe hacia d√≥nde va.",
    
    // CORRECCI√ìN 2: Presupuesto y Cuidado enf√°tico
    3: "<strong>Has asignado Presupuesto (PSG).</strong><br>Los Presupuestos Sensibles al G√©nero no pueden limitarse a una etiqueta t√©cnica. Deben traducirse en apropiaciones concretas: salas de lactancia dotadas, flexibilizaci√≥n de turnos con respaldo administrativo, rutas de transporte seguras financiadas. Sin asignaciones espec√≠ficas para estas medidas, la pol√≠tica de g√©nero se reduce a una declaraci√≥n formal sin capacidad transformadora."
};

// 1. ABRIR CONSOLA
function openRepair(id) {
    if(document.getElementById(`fail-${id}`).classList.contains('repaired')) return;

    activeProblem = id;
    
    // UI Updates
    document.getElementById('console').style.display = 'block';
    document.getElementById('console-error').style.display = 'none';
    
    // Scroll suave
    document.getElementById('console').scrollIntoView({behavior: "smooth"});

    // Actualizar t√≠tulo consola - CAMBIO TERMINOLOG√çA
    let problemName = "";
    if(id===1) problemName = "VAC√çO NORMATIVO";
    if(id===2) problemName = "FALTA DE RUMBO";
    if(id===3) problemName = "SIN RECURSOS";
    
    document.getElementById('console-title').innerText = `REDEFINIENDO: ${problemName} - SELECCIONA HERRAMIENTA:`;
}

// 2. INTENTAR REDEFINIR/TRANSFORMAR
function tryFix(toolType) {
    let success = false;

    if (activeProblem === 1 && toolType === 'norma') success = true;
    if (activeProblem === 2 && toolType === 'plan') success = true;
    if (activeProblem === 3 && toolType === 'presupuesto') success = true;

    if (success) {
        // √âXITO
        document.getElementById('console').style.display = 'none';
        
        // Actualizar Tarjeta visualmente
        const card = document.getElementById(`fail-${activeProblem}`);
        card.classList.add('repaired');
        document.getElementById(`icon-${activeProblem}`).innerText = "üõ°Ô∏è";
        
        // CAMBIO VISUAL: "SISTEMA INTEGRAL" en lugar de SEGURO/REPARADO
        document.getElementById(`hint-${activeProblem}`).innerText = "TRANSFORMADO";
        document.getElementById(`hint-${activeProblem}`).style.background = "#00A499"; 

        // Mostrar Modal Educativo con los Textos Corregidos
        const modal = document.getElementById('success-modal');
        document.getElementById('modal-text').innerHTML = feedbackData[activeProblem];
        modal.style.display = 'flex';
        
        repairsCompleted++;
        activeProblem = 0;

    } else {
        // ERROR
        const err = document.getElementById('console-error');
        err.style.display = 'block';
        gsap.from(err, {x:10, duration:0.1, repeat:3, yoyo:true});
    }
}

// 3. CERRAR MODAL
function closeModal() {
    document.getElementById('success-modal').style.display = 'none';
    
    if(repairsCompleted === 3) {
        // CAMBIO: T√≠tulo final alineado
        document.querySelector('.station-title').innerText = "¬°INSTITUCI√ìN TRANSFORMADA!";
        document.querySelector('.station-title').style.color = "#00A499";
        document.querySelector('.station-desc').innerText = "Has establecido las bases para una protecci√≥n redefinida desde la seguridad humana.";
    }
}
</script>