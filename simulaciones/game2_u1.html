<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<style>
    /* --- AMBIENTACIN Y ESTRUCTURA --- */
:root {
    --bg-dark: #170047;                 /* Fondo principal */
    --card-bg: rgba(72, 2, 65, 0.85);    /* Card elevada */

    --boss-color: #E44700;              /* Jefe: amenaza directa */
    --player-color: #FEC82F;            /* Jugadora: agencia / foco */

    --tension-low: #EE7D4F;              /* Tensi贸n baja */
    --tension-mid: #D23B78;              /* Tensi贸n media */
    --tension-high: #E44700;             /* Tensi贸n alta (cr铆tica) */

    --text-color: #ffffff;               /* Texto principal */
}


    #game-role-wrapper {
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: radial-gradient(circle at center, #312e81, #111827);
        min-height: 650px;
        color: var(--text-color);
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        position: relative;
        overflow: hidden;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    }

    /* Efecto de "Oficina Tensa" - Sutil parpadeo de luz */
    #game-role-wrapper::after {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.1);
        animation: flicker 8s infinite;
        pointer-events: none;
        z-index: 1;
    }

    @keyframes flicker {
        0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 0; }
        20%, 24%, 55% { opacity: 0.1; }
    }

    .role-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        width: 100%;
        max-width: 550px;
        height: 550px; /* Altura fija para mantener layout */
        position: relative;
        z-index: 10;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: transform 0.1s;
    }

    /* --- BARRA DE TENSIN --- */
    .tension-header {
        padding: 15px 20px;
        background: rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        gap: 15px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .tension-label { font-size: 0.8rem; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
    
    .tension-bar-bg {
        flex-grow: 1;
        height: 10px;
        background: rgba(255,255,255,0.1);
        border-radius: 5px;
        overflow: hidden;
    }

    .tension-fill {
        height: 100%;
        width: 0%;
        background: var(--tension-low);
        transition: width 0.3s, background 0.3s;
    }

    /* --- REA DE DRAMATIZACIN (Chat) --- */
    .drama-stage {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
        scrollbar-width: thin;
        scrollbar-color: var(--player-color) rgba(0,0,0,0.3);
    }

    .msg-bubble {
        padding: 12px 18px;
        border-radius: 12px;
        max-width: 85%;
        font-size: 0.95rem;
        line-height: 1.5;
        animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
    }

    @keyframes popIn {
        from { opacity: 0; transform: scale(0.9) translateY(10px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
    }

    /* Estilos de personajes */
    .msg-boss {
        background: rgba(127, 29, 29, 0.4); /* Rojo oscuro transparente */
        border-left: 4px solid var(--boss-color);
        align-self: flex-start;
        color: #fecaca;
    }
    .msg-boss::before { content: 'Director General (Jefe)'; font-size: 0.7rem; color: var(--boss-color); display: block; margin-bottom: 5px; font-weight: bold; }

    .msg-player {
        background: rgba(49, 46, 129, 0.6); /* Azul oscuro transparente */
        border-right: 4px solid var(--player-color);
        align-self: flex-end;
        color: #e0e7ff;
        text-align: right;
    }
    .msg-player::before { content: 'T (Especialista)'; font-size: 0.7rem; color: var(--player-color); display: block; margin-bottom: 5px; font-weight: bold; }

    .msg-narrator {
        text-align: center;
        font-style: italic;
        color: #94a3b8;
        font-size: 0.85rem;
        margin: 10px 0;
        align-self: center;
        background: rgba(0,0,0,0.2);
        padding: 5px 15px;
        border-radius: 20px;
    }

    /* --- REA DE INTERACCIN --- */
    .interaction-area {
        padding: 20px;
        background: rgba(15, 23, 42, 0.95);
        border-top: 1px solid rgba(255,255,255,0.1);
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .choice-btn {
        background: transparent;
        border: 1px solid var(--player-color);
        color: var(--player-color);
        padding: 12px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: left;
        font-size: 0.9rem;
    }

    .choice-btn:hover {
        background: var(--player-color);
        color: #0f172a;
    }

    /* Animaci贸n de Tensi贸n (Sacudida) */
    .shake { animation: shake 0.5s; }
    @keyframes shake {
        0% { transform: translate(1px, 1px) rotate(0deg); }
        10% { transform: translate(-1px, -2px) rotate(-1deg); }
        20% { transform: translate(-3px, 0px) rotate(1deg); }
        30% { transform: translate(3px, 2px) rotate(0deg); }
        40% { transform: translate(1px, -1px) rotate(1deg); }
        50% { transform: translate(-1px, 2px) rotate(-1deg); }
        60% { transform: translate(-3px, 1px) rotate(0deg); }
        100% { transform: translate(0, 0) rotate(0); }
    }

    /* Pantalla Final */
    /* Pantalla Final Corregida */
    .end-screen {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(15, 23, 42, 0.98);
        z-index: 50;
        display: none; 
        /* Cambiamos la l贸gica de flexbox para permitir scroll */
        flex-direction: column;
        align-items: center;
        justify-content: flex-start; /* Alinea al inicio para no cortar la parte superior */
        overflow-y: auto; /* Habilita el scroll vertical */
        scrollbar-width: thin; /* Estilo de scroll fino */
        scrollbar-color: var(--player-color) var(--bg-dark);
    }

    /* Nuevo contenedor interno para agrupar el texto */
    .end-content-wrapper {
        margin: auto; /* Truco de Flexbox: esto centra verticalmente autom谩ticamente */
        padding: 40px 30px; /* Espacio interno generoso */
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        width: 100%;
        box-sizing: border-box; /* Asegura que el padding no desborde el ancho */
    }
    
    .concept-tag {
        background: #4c1d95;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin: 5px;
        display: inline-block;
    }

    @media (max-width: 600px) {
        .role-card { height: 100vh; border-radius: 0; border: none; }
        .msg-bubble { max-width: 95%; }
    }
</style>
</head>
<body>

<div id="game-role-wrapper">
    <div class="role-card" id="game-card">
        
        <!-- Barra Superior -->
        <div class="tension-header">
            <span class="tension-label">Nivel de Tensi贸n</span>
            <div class="tension-bar-bg">
                <div class="tension-fill" id="tension-fill"></div>
            </div>
            <span id="tension-emoji"></span>
        </div>

        <!-- Escenario de Chat -->
        <div class="drama-stage" id="chat-box">
            <div class="msg-narrator">
                Est谩s en el Comit茅 de Evaluaci贸n de Riesgo. Eres la especialista t茅cnica con m谩s experiencia en la sala. El resto son directivos hombres.
            </div>
            <div class="msg-boss">
                Bien, se帽ores. Como 铆bamos diciendo, el esquema del protegido X se mantiene igual. No veo razones para cambios dr谩sticos.
            </div>
        </div>

        <!-- Opciones -->
        <div class="interaction-area" id="options-box">
            <button class="choice-btn" onclick="makeChoice(1)">Levantar la mano: "Director, los datos de terreno muestran un riesgo inminente."</button>
            <button class="choice-btn" onclick="makeChoice(2)">Quedarse callada y anotar en la libreta (Evitar conflicto).</button>
        </div>

        <!-- Pantalla Final -->
        <div class="end-screen" id="end-screen">
            <!-- Nuevo Wrapper comienza aqu铆 -->
            <div class="end-content-wrapper">
                <h2 style="color: var(--boss-color); margin-top: 0;">ANLISIS DE LA SITUACIN</h2>
                <p id="end-message" style="line-height: 1.6; font-size: 1rem;"></p>
                <div id="concepts-revealed" style="margin: 25px 0;"></div>
                <button class="choice-btn" style="text-align: center; background: var(--player-color); color:black; font-weight: bold; width: auto; padding: 10px 30px;" onclick="location.reload()">
                    Reintentar Simulaci贸n
                </button>
            </div>
            <!-- Nuevo Wrapper termina aqu铆 -->
        </div>

    </div>
</div>

<script>
    let tension = 20; // 0 a 100
    let currentStep = 0;
    
    // Base de datos de la narrativa (rbol de decisiones simple)
    const story = {
        1: { // Opci贸n: Hablar
            narrator: "El Director te mira por encima de sus gafas. Varios colegas revisan sus celulares.",
            boss: "驴Riesgo inminente? Mire, doctora... no nos pongamos dram谩ticos. Aqu铆 nos basamos en hechos, no en corazonadas.",
            tensionImpact: 20,
            options: [
                { text: "Insistir: 'No es una corazonada. Es el informe t茅cnico 4B.'", next: 3 },
                { text: "Disculparse: 'Quiz谩s me expres茅 mal, lo revisar茅.'", next: 4 }
            ]
        },
        2: { // Opci贸n: Callar
            narrator: "Decides no intervenir. La reuni贸n contin煤a. Sientes una punzada en el est贸mago.",
            boss: "Perfecto. Si no hay objeciones, cerramos el acta. Ah, y tr谩iganos caf茅, por favor.",
            tensionImpact: 10,
            options: [
                { text: "Hacerlo notar: 'Yo soy especialista, no asistente.'", next: 5 },
                { text: "Ignorarlo y salir de la sala frustrada.", next: 6 }
            ]
        },
        3: { // Opci贸n: Insistir (Confrontaci贸n)
            narrator: "El ambiente se corta con un cuchillo. Un colega te interrumpe.",
            boss: "(Interrupci贸n) A ver, ni帽a, d茅jeme terminar. Ya sabemos leer informes. Lo que necesitamos es criterio pol铆tico.",
            tensionImpact: 30, // Tensi贸n cr铆tica
            options: [
                { text: "Finalizar Simulaci贸n", next: 99, outcome: "aggressive" }
            ]
        },
        4: { // Opci贸n: Sumisi贸n (Gaslighting)
            narrator: "Bajas la mirada. El director sonr铆e con condescendencia.",
            boss: "As铆 me gusta. Hay que aprender a escuchar a los que llevan a帽os en esto.",
            tensionImpact: 5,
            options: [
                { text: "Finalizar Simulaci贸n", next: 99, outcome: "passive" }
            ]
        },
        5: { // Opci贸n: Defender rol (Jerarqu铆a)
            narrator: "Se hace un silencio inc贸modo.",
            boss: "Vaya car谩cter. Aqu铆 en la UNP somos una familia, colaboramos en todo. No sea conflictiva.",
            tensionImpact: 40,
            options: [
                { text: "Finalizar Simulaci贸n", next: 99, outcome: "hierarchy" }
            ]
        },
        6: { // Salir (Invisibilizaci贸n)
            narrator: "Sales de la sala. Nadie nota tu salida. Tu aporte t茅cnico fue ignorado.",
            boss: "",
            tensionImpact: 0,
            options: [
                { text: "Finalizar Simulaci贸n", next: 99, outcome: "invisible" }
            ]
        }
    };

    function makeChoice(choiceIndex) {
        // L贸gica inicial para el primer paso
        if (currentStep === 0) {
            handleScene(choiceIndex); // 1 o 2
        } else {
            // L贸gica para pasos siguientes basada en el objeto options
            // Esto es simplificado para JS puro sin frameworks
        }
    }

    // Funci贸n principal de renderizado de escena
    function handleScene(sceneId, outcome = null) {
        
        if (sceneId === 99) {
            showEnding(outcome);
            return;
        }

        const sceneData = story[sceneId];
        currentStep = sceneId;

        // Actualizar Tensi贸n
        updateTension(sceneData.tensionImpact);

        // Renderizar Narrador
        if (sceneData.narrator) {
            addMessage(sceneData.narrator, 'msg-narrator');
        }

        // Renderizar Jefe (con delay para realismo)
        if (sceneData.boss) {
            setTimeout(() => {
                addMessage(sceneData.boss, 'msg-boss');
                triggerShake(); // El jefe siempre genera tensi贸n
            }, 600);
        }

        // Renderizar botones
        setTimeout(() => {
            renderButtons(sceneData.options);
        }, 1200);
    }

    function addMessage(text, className) {
        const chatBox = document.getElementById('chat-box');
        const bubble = document.createElement('div');
        bubble.className = `msg-bubble ${className}`;
        bubble.innerText = text;
        chatBox.appendChild(bubble);
        chatBox.scrollTop = chatBox.scrollHeight; // Auto scroll
    }

    function renderButtons(options) {
        const optionsBox = document.getElementById('options-box');
        optionsBox.innerHTML = ''; // Limpiar anteriores

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = opt.text;
            
            // Asignar evento
            btn.onclick = function() {
                // Agregar mensaje del jugador antes de cambiar escena
                addMessage(opt.text.split(':')[0], 'msg-player'); // Solo muestra la parte antes de los dos puntos o resumen
                
                // Peque帽a pausa
                setTimeout(() => {
                    if (opt.outcome) {
                        handleScene(opt.next, opt.outcome);
                    } else {
                        handleScene(opt.next);
                    }
                }, 500);
            };
            
            optionsBox.appendChild(btn);
        });
    }

    function updateTension(amount) {
        tension += amount;
        if (tension > 100) tension = 100;
        
        const fill = document.getElementById('tension-fill');
        const emoji = document.getElementById('tension-emoji');

        fill.style.width = `${tension}%`;

        // Colores y Emojis seg煤n nivel
        if (tension < 40) {
            fill.style.background = "var(--tension-low)";
            emoji.innerText = "";
        } else if (tension < 75) {
            fill.style.background = "var(--tension-mid)";
            emoji.innerText = "";
        } else {
            fill.style.background = "var(--tension-high)";
            emoji.innerText = "が";
        }
    }

    function triggerShake() {
        const card = document.getElementById('game-card');
        card.classList.remove('shake');
        void card.offsetWidth; // Trigger reflow
        card.classList.add('shake');
    }

    function showEnding(outcome) {
        const screen = document.getElementById('end-screen');
        const msg = document.getElementById('end-message');
        const concepts = document.getElementById('concepts-revealed');
        
        screen.style.display = "flex";
        
        let analysis = "";
        let tags = "";

        switch(outcome) {
            case 'aggressive':
                analysis = "Intentaste imponer tu criterio t茅cnico, pero fuiste silenciada. El jefe us贸 tu tono para etiquetarte de 'emocional' y desvalidar tu argumento profesional.";
                tags = "<span class='concept-tag'>Tone Policing</span> <span class='concept-tag'>Gaslighting</span>";
                break;
            case 'passive':
                analysis = "Decidiste ceder para evitar problemas. La armon铆a se mantuvo, pero el riesgo de seguridad persiste y tu rol fue reducido al de una subordinada sin voz.";
                tags = "<span class='concept-tag'>Invisibilizaci贸n</span> <span class='concept-tag'>Rol de G茅nero</span>";
                break;
            case 'hierarchy':
                analysis = "Al defender tu estatus, apelaron a la 'familia' (chantaje emocional) para mantenerte en tu lugar. La jerarqu铆a se us贸 para frenar la competencia t茅cnica femenina.";
                tags = "<span class='concept-tag'>Abuso Jer谩rquico</span> <span class='concept-tag'>Techo de Cristal</span>";
                break;
            case 'invisible':
                analysis = "Tu salida pas贸 desapercibida. En estructuras r铆gidas, la ausencia de las mujeres en la toma de decisiones se normaliza tanto que ni siquiera se nota su falta.";
                tags = "<span class='concept-tag'>Exclusi贸n Sistem谩tica</span>";
                break;
        }

        msg.innerHTML = `<strong>Resultado:</strong> ${analysis}<br><br>驴Notaste lo dif铆cil que fue acertar? Las estructuras desiguales crean escenarios donde perder es la norma.`;
        concepts.innerHTML = tags;
    }
</script>

</body>
</html>