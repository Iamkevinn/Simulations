<!-- LIBRER√çAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Inter:wght@400;700&display=swap" rel="stylesheet">

<style>
/* --- ESTILOS IDENTIDAD COLOMBIA SIN MACHISMO (CLARO) --- */
:root {
    --bg-main: #F8FAFC;         /* Fondo claro */
    --bg-panel: #FFFFFF;        /* Tarjetas blancas */
    
    --brand-purple: #582C83;    /* Morado Institucional (Principal) */
    --brand-magenta: #D23B78;   /* Magenta (Acento) */
    --brand-orange: #F47920;    /* Naranja (Acci√≥n/Alerta) */
    --brand-yellow: #FFC82F;    /* Amarillo (Detalle) */

    --text-main: #334155;       /* Gris oscuro para lectura */
    --text-light: #64748B;      /* Texto secundario */

    --border-color: #E2E8F0;
}

#voice-analyst-container {
    width: 100%;
    min-height: 850px;
    height: auto;
    background-color: var(--bg-main) !important;
    font-family: 'Inter', sans-serif;
    color: var(--text-main) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    position: relative;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,0,0,0.05);
}

/* --- VISUALIZADOR DE ONDAS (SUAVE) --- */
.sound-wave-container {
    position: absolute;
    top: 120px; /* Ajustado para que no tape el header */
    left: 0; width: 100%; height: 150px;
    display: flex; justify-content: center; align-items: center;
    gap: 8px; opacity: 0.15; pointer-events: none; z-index: 0;
}
.bar {
    width: 12px; 
    background: var(--brand-purple);
    border-radius: 20px;
    animation: equalizer 1s infinite ease-in-out;
}
@keyframes equalizer {
    0% { height: 20px; }
    50% { height: 100px; opacity: 0.8; }
    100% { height: 20px; }
}
/* Variaci√≥n de colores de marca */
.bar:nth-child(odd) { animation-duration: 0.8s; background: var(--brand-magenta); }
.bar:nth-child(2n) { animation-duration: 1.1s; background: var(--brand-orange); }
.bar:nth-child(3n) { animation-duration: 1.3s; background: var(--brand-purple); }

/* --- HEADER CON LOGOS --- */
.audio-header {
    z-index: 10; padding: 20px 30px; 
    background: #FFFFFF !important;
    border-bottom: 4px solid var(--brand-purple) !important;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.client-logo {
    height: 55px;
    width: auto;
    object-fit: contain;
    display: block;
}

.header-center {
    flex: 1;
    text-align: center;
    min-width: 280px;
}

.audio-title {
    font-family: 'Share Tech Mono', monospace;
    font-size: clamp(1.4rem, 4vw, 1.8rem);
    color: var(--brand-purple) !important;
    margin: 0; text-transform: uppercase; letter-spacing: 1px;
    font-weight: bold;
}
.audio-subtitle { 
    color: var(--brand-orange) !important; 
    margin-top: 5px; font-size: 0.95rem; font-weight: 700; 
}

/* --- NAVEGACI√ìN --- */
.audio-nav {
    display: flex; justify-content: center; gap: 15px; padding: 20px;
    background: #F1F5F9 !important; z-index: 10; flex-wrap: wrap;
    border-bottom: 1px solid var(--border-color);
}
.nav-audio-btn {
    background-color: #FFFFFF !important; color: var(--text-light) !important;
    border: 2px solid var(--border-color) !important; padding: 12px 30px;
    cursor: pointer; font-family: 'Share Tech Mono', monospace;
    font-size: 1rem; text-transform: uppercase; transition: 0.2s;
    min-width: 160px; border-radius: 6px;
    font-weight: 600;
}
.nav-audio-btn:hover {
    background-color: #fff !important;
    color: var(--brand-purple) !important;
    border-color: var(--brand-purple) !important;
}
.nav-audio-btn.active {
    background-color: var(--brand-purple) !important; color: #FFFFFF !important;
    border-color: var(--brand-purple) !important; font-weight: bold;
    box-shadow: 0 4px 10px rgba(88, 44, 131, 0.2);
}

/* --- VISTAS --- */
.content-viewport {
    flex: 1; padding: 30px; position: relative; z-index: 5;
    display: flex; justify-content: center;
}

/* VISTA 1: TIPOLOG√çAS (CARDS) */
.types-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px; width: 100%; max-width: 1100px; display: none;
}
.type-card {
    background-color: var(--bg-panel) !important;
    border: 1px solid var(--border-color) !important; 
    border-left: 5px solid var(--brand-magenta) !important;
    padding: 25px; border-radius: 8px; position: relative;
    transition: transform 0.3s, box-shadow 0.3s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.type-card:hover { 
    transform: translateY(-5px); 
    box-shadow: 0 10px 20px rgba(0,0,0,0.08);
}
.t-header { 
    font-family: 'Share Tech Mono', monospace; 
    font-size: 1.2rem; color: var(--brand-purple) !important; 
    margin-bottom: 10px; font-weight: bold;
}
.t-body { font-size: 0.95rem; line-height: 1.6; color: var(--text-main) !important; }

/* VISTA 2: SIMULADOR (FORO) */
.forum-console {
    width: 100%; max-width: 1000px; display: none; flex-direction: column;
    background-color: #FFFFFF !important; 
    border: 1px solid var(--border-color); padding: 30px;
    border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
}

/* REPRODUCTOR DE TESTIMONIO */
.player-box {
    background-color: #F8FAFC !important; 
    border: 1px solid var(--brand-purple);
    padding: 20px; border-radius: 8px; margin-bottom: 30px;
    display: flex; flex-direction: column; gap: 10px;
}
.player-label { 
    color: var(--brand-magenta) !important; 
    font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; font-weight: bold; 
}
.transcript-text {
    font-size: 1.1rem; line-height: 1.6; color: var(--text-main) !important; font-style: italic;
    background: #FFFFFF; padding: 20px; border-left: 4px solid var(--brand-orange);
    border-radius: 0 8px 8px 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
}

/* INTERACCI√ìN */
.analysis-board {
    display: flex; gap: 30px; flex-wrap: wrap;
}
.board-col { flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 15px; }
.col-head {
    color: var(--brand-purple); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;
    border-bottom: 2px solid var(--border-color); padding-bottom: 8px; margin-bottom: 10px; font-weight: bold;
}

/* BOTONES DE OPCI√ìN */
.analysis-btn {
    background-color: #FFFFFF !important;
    color: var(--text-main) !important; padding: 18px; 
    border: 1px solid var(--border-color) !important;
    cursor: pointer; text-align: left; border-radius: 8px; transition: 0.2s;
    display: flex; align-items: center; justify-content: space-between;
    font-weight: 500;
    box-shadow: 0 2px 4px rgba(0,0,0,0.02);
}
.analysis-btn:hover { 
    background-color: #FDF4FF !important; /* Lila muy claro */
    border-color: var(--brand-purple) !important; 
    transform: translateY(-2px);
}
.analysis-btn.selected {
    background-color: var(--brand-purple) !important; color: #FFFFFF !important;
    border-color: var(--brand-purple) !important; font-weight: bold;
}
.analysis-btn.correct {
    background-color: #DCFCE7 !important; /* Verde pastel */
    color: #166534 !important; /* Verde oscuro */
    border-color: #22C55E !important; 
    pointer-events: none;
}
.analysis-btn.wrong {
    background-color: #FEF2F2 !important; /* Rojo pastel */
    color: #991B1B !important;
    border-color: #EF4444 !important;
    animation: shake 0.3s;
}

/* FEEDBACK */
.console-feedback {
    margin-top: 25px; padding: 20px; 
    background: #F1F5F9; border: 1px solid var(--border-color); border-radius: 8px;
    font-family: 'Share Tech Mono', monospace; 
    color: var(--brand-purple); text-align: center; font-weight: bold;
}

@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

/* RESPONSIVE */
@media (max-width: 900px) {
    .audio-header { flex-direction: column; text-align: center; }
    .client-logo { height: 45px; margin-bottom: 10px; }
    .analysis-board { flex-direction: column; }
    .nav-audio-btn { width: 100%; }
}

</style>

<div id="voice-analyst-container">
    
    <!-- Animaci√≥n de fondo (Barras Colores Marca) -->
    <div class="sound-wave-container">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>

    <!-- HEADER CON LOGOS -->
    <div class="audio-header">
        <!-- Logo Izquierdo: UNP -->
        <img src="../Styles/UNP I.svg" alt="Logo UNP" class="client-logo">
        
        <div class="header-center">
            <h2 class="audio-title">Unidad 3: Violencias Espec√≠ficas</h2>
            <div class="audio-subtitle">An√°lisis de Riesgos y Estrategias de Prevenci√≥n</div>
        </div>

        <!-- Logo Derecho: Comisi√≥n -->
        <img src="../Styles/logo.png" alt="Logo Comisi√≥n" class="client-logo">
    </div>

    <!-- NAV -->
    <div class="audio-nav">
        <button class="nav-audio-btn active" onclick="setAudioView('concepts')">üìä Tipolog√≠as</button>
        <button class="nav-audio-btn" onclick="setAudioView('sim')">üéôÔ∏è Mesa de An√°lisis</button>
    </div>

    <!-- CONTENIDO -->
    <div class="content-viewport">
        
        <!-- VISTA 1: TIPOLOG√çAS -->
        <div id="view-concepts" class="types-grid" style="display: grid;">
            <div class="type-card">
                <div class="t-header">Violencia F√≠sica</div>
                <div class="t-body">Agresiones corporales directas motivadas por prejuicio hacia la orientaci√≥n sexual o identidad de g√©nero.</div>
            </div>
            <div class="type-card">
                <div class="t-header">Violencia Simb√≥lica</div>
                <div class="t-body">Mensajes culturales, estereotipos y exclusiones sutiles que deslegitiman las identidades diversas.</div>
            </div>
            <div class="type-card">
                <div class="t-header">Violencia Institucional</div>
                <div class="t-body">Barreras administrativas, revictimizaci√≥n o negligencia por parte de funcionarios/as p√∫blicos.</div>
            </div>
            <div class="type-card">
                <div class="t-header">Microviolencias</div>
                <div class="t-body">Peque√±as agresiones cotidianas (ej: chistes, miradas, uso incorrecto de pronombres) que normalizan la discriminaci√≥n.</div>
            </div>
        </div>

        <!-- VISTA 2: SIMULADOR (FORO) -->
        <div id="view-sim" class="forum-console">
            
            <!-- REPRODUCTOR -->
            <div class="player-box">
                <div class="player-label">‚ñ∂ REPRODUCIENDO TESTIMONIO #01</div>
                <div class="transcript-text" id="transcript">
                    "Soy l√≠der LGBTIQ+. Ayer fui a la oficina local para actualizar mi riesgo. El vigilante se burl√≥ de mi ropa, y el funcionario me dijo que 'esas cosas' no son prioridad y que volviera otro d√≠a, a pesar de que tengo amenazas escritas."
                </div>
            </div>

            <!-- TABLERO DE AN√ÅLISIS -->
            <div class="analysis-board">
                <!-- Columna 1: Diagn√≥stico -->
                <div class="board-col">
                    <div class="col-head">1. DIAGN√ìSTICO: ¬øQU√â VIOLENCIA ES?</div>
                    <button class="analysis-btn" onclick="checkStep(1, 'fisica', this)">A. Violencia F√≠sica Directa</button>
                    <button class="analysis-btn" onclick="checkStep(1, 'inst', this)">B. Institucional y Microviolencias</button>
                    <button class="analysis-btn" onclick="checkStep(1, 'simb', this)">C. Solo Violencia Simb√≥lica</button>
                </div>

                <!-- Columna 2: Soluci√≥n -->
                <div class="board-col">
                    <div class="col-head">2. ESTRATEGIA: ¬øQU√â HACER?</div>
                    <button class="analysis-btn" onclick="checkStep(2, 'cap', this)">A. Capacitaci√≥n y Protocolo Diferencial</button>
                    <button class="analysis-btn" onclick="checkStep(2, 'nada', this)">B. Ignorar, fue un malentendido</button>
                    <button class="analysis-btn" onclick="checkStep(2, 'policia', this)">C. Llamar a la polic√≠a inmediatamente</button>
                </div>
            </div>

            <div class="console-feedback" id="feedback-txt">
                ESPERANDO AN√ÅLISIS DEL EXPERTO...
            </div>
            
            <button id="next-case-btn" class="nav-audio-btn" style="display:none; margin: 20px auto 0 auto; background:#F47920!important; color:white!important; border-color:#F47920!important;" onclick="nextCase()">SIGUIENTE TESTIMONIO >></button>

        </div>

    </div>
</div>

<script>
// --- CONTROL DE VISTAS ---
function setAudioView(view) {
    document.querySelectorAll('.nav-audio-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');

    const concepts = document.getElementById('view-concepts');
    const sim = document.getElementById('view-sim');

    if (view === 'concepts') {
        sim.style.display = 'none';
        concepts.style.display = 'grid';
        gsap.from(".type-card", {y: 20, opacity: 0, stagger: 0.1});
    } else {
        concepts.style.display = 'none';
        sim.style.display = 'flex';
        gsap.from(".player-box", {scale: 0.95, opacity: 0});
    }
}

// --- L√ìGICA DEL SIMULADOR ---
const casesData = [
    {
        text: "\"Soy l√≠der LGBTIQ+. Ayer fui a la oficina local. El vigilante se burl√≥ de mi ropa, y el funcionario me dijo que 'esas cosas' no son prioridad y que volviera otro d√≠a, a pesar de que tengo amenazas.\"",
        correctViol: 'inst',
        correctSol: 'cap',
        fb: "CORRECTO. Es Violencia Institucional (barreras) y Microviolencias (burlas). Soluci√≥n: Capacitaci√≥n en trato digno y Protocolos Diferenciales."
    },
    {
        text: "\"En mi comunidad me prohibieron entrar al sal√≥n comunal por ser trans. Dicen que doy 'mal ejemplo'. Adem√°s, han aparecido grafitis amenazantes en mi puerta.\"",
        correctViol: 'simb',
        correctSol: 'riesgo', 
        fb: "CORRECTO. Es Violencia Simb√≥lica (exclusi√≥n) y Amenaza (grafitis). Soluci√≥n: Activar ruta de riesgo espec√≠fica para l√≠deres."
    }
];

let currentCase = 0;
let step1Done = false;
let step2Done = false;

function checkStep(step, value, btn) {
    const feedback = document.getElementById('feedback-txt');
    const currentData = casesData[currentCase];

    // Resetear colores en esa columna
    let parent = btn.parentElement;
    parent.querySelectorAll('.analysis-btn').forEach(b => {
        b.classList.remove('selected', 'wrong', 'correct');
    });

    // Validar
    let isCorrect = false;
    if (step === 1 && value === currentData.correctViol) isCorrect = true;
    if (step === 2 && value === currentData.correctSol) isCorrect = true;
    
    // L√≥gica interna
    if (currentCase === 1 && step === 1 && value === 'simb') isCorrect = true;
    if (currentCase === 1 && step === 2 && value === 'cap') isCorrect = true; 

    if (isCorrect) {
        btn.classList.add('correct');
        if(step === 1) step1Done = true;
        if(step === 2) step2Done = true;
        
        if(step1Done && step2Done) {
            feedback.innerText = currentData.fb;
            feedback.style.color = "#16A34A"; // Verde oscuro legible
            document.getElementById('next-case-btn').style.display = 'block';
        } else {
            feedback.innerText = "Diagn√≥stico parcial correcto. Contin√∫a...";
            feedback.style.color = "#582C83"; // Morado marca
        }
    } else {
        btn.classList.add('wrong');
        feedback.innerText = "AN√ÅLISIS INCORRECTO. Revisa los conceptos.";
        feedback.style.color = "#DC2626"; // Rojo oscuro legible
    }
}

function nextCase() {
    currentCase++;
    if(currentCase < casesData.length) {
        document.getElementById('transcript').innerText = casesData[currentCase].text;
        
        step1Done = false; step2Done = false;
        document.querySelectorAll('.analysis-btn').forEach(b => b.classList.remove('correct', 'wrong', 'selected'));
        document.getElementById('next-case-btn').style.display = 'none';
        document.getElementById('feedback-txt').innerText = "ESPERANDO AN√ÅLISIS...";
        document.getElementById('feedback-txt').style.color = "#582C83";
        
        if(currentCase === 1) {
            const cols = document.querySelectorAll('.board-col');
            cols[0].querySelectorAll('button')[0].innerText = "A. Violencia F√≠sica";
            cols[0].querySelectorAll('button')[1].innerText = "B. Violencia Institucional";
            cols[0].querySelectorAll('button')[2].innerText = "C. Violencia Simb√≥lica y Amenaza"; 
            
            cols[1].querySelectorAll('button')[0].innerText = "A. Activar Ruta de Riesgo L√≠deres"; 
            cols[1].querySelectorAll('button')[1].innerText = "B. Ignorar";
            cols[1].querySelectorAll('button')[2].innerText = "C. Medidas policivas simples";
        }
        
        gsap.from(".player-box", {opacity: 0, x: -20});
        
    } else {
        document.getElementById('view-sim').innerHTML = `<div style='text-align:center; padding:40px;'><h2 style='color:#582C83'>¬°SESI√ìN COMPLETADA!</h2><p style='color:#333'>Has identificado correctamente las violencias y sus estrategias de prevenci√≥n.</p></div>`;
    }
}
</script>