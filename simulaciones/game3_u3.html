<!-- LIBRER√çAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Inter:wght@400;700&display=swap" rel="stylesheet">

<style>
/* --- ESTILOS DE FUERZA BRUTA (SOLID COLORS) --- */
:root {
    --audio-bg: #170047;        /* Fondo profundo */
    --audio-panel: #480241;     /* Panel s√≥lido */

    --neon-pink: #E44700;       /* Violencia / Alerta */
    --neon-cyan: #FEC82F;       /* Soluci√≥n / Acci√≥n / Tech */
    --neon-green: #EE7D4F;      /* √âxito / Resoluci√≥n */

    --text-main: #ffffff;

    --btn-solid: #480241;       /* Bot√≥n estable, no reactivo */
}


#voice-analyst-container {
    width: 100%;
    min-height: 850px;
    height: auto;
    background-color: var(--audio-bg) !important;
    font-family: 'Inter', sans-serif;
    color: var(--text-main) !important;
    border: 2px solid #333 !important;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    position: relative;
    overflow: hidden;
}

/* --- VISUALIZADOR DE ONDAS (ANIMACI√ìN CONSTANTE) --- */
.sound-wave-container {
    position: absolute;
    top: 50%; left: 0; width: 100%; height: 200px;
    transform: translateY(-50%);
    display: flex; justify-content: center; align-items: center;
    gap: 5px; opacity: 0.1; pointer-events: none; z-index: 0;
}
.bar {
    width: 10px; background: var(--neon-pink);
    animation: equalizer 1s infinite ease-in-out;
}
@keyframes equalizer {
    0% { height: 20px; }
    50% { height: 150px; opacity: 0.5; }
    100% { height: 20px; }
}
/* Generar variaci√≥n en las barras */
.bar:nth-child(odd) { animation-duration: 0.8s; background: var(--neon-cyan); }
.bar:nth-child(2n) { animation-duration: 1.1s; }
.bar:nth-child(3n) { animation-duration: 1.3s; }

/* --- HEADER --- */
.audio-header {
    z-index: 10; padding: 25px; text-align: center;
    background: #000000 !important;
    border-bottom: 2px solid var(--neon-pink) !important;
}
.audio-title {
    font-family: 'Share Tech Mono', monospace;
    font-size: clamp(1.5rem, 4vw, 2.2rem);
    color: var(--neon-pink) !important;
    margin: 0; text-transform: uppercase; letter-spacing: 2px;
}
.audio-subtitle { color: #ccc !important; margin-top: 5px; font-size: 0.9rem; }

/* --- NAVEGACI√ìN --- */
.audio-nav {
    display: flex; justify-content: center; gap: 15px; padding: 20px;
    background: #111 !important; z-index: 10; flex-wrap: wrap;
}
.nav-audio-btn {
    background-color: #222 !important; color: #fff !important;
    border: 1px solid #555 !important; padding: 12px 30px;
    cursor: pointer; font-family: 'Share Tech Mono', monospace;
    font-size: 1rem; text-transform: uppercase; transition: 0.2s;
    min-width: 160px;
}
.nav-audio-btn.active {
    background-color: var(--neon-pink) !important; color: #000 !important;
    border-color: #fff !important; font-weight: bold;
    box-shadow: 0 0 15px var(--neon-pink);
}

/* --- VISTAS --- */
.content-viewport {
    flex: 1; padding: 20px; position: relative; z-index: 5;
    display: flex; justify-content: center;
}

/* VISTA 1: TIPOLOG√çAS (CARDS) */
.types-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px; width: 100%; max-width: 1100px; display: none;
}
.type-card {
    background-color: var(--audio-panel) !important;
    border: 1px solid #444 !important; border-left: 5px solid var(--neon-cyan) !important;
    padding: 25px; border-radius: 5px; position: relative;
    transition: transform 0.3s;
}
.type-card:hover { transform: translateY(-5px); border-color: var(--neon-cyan) !important; }
.t-header { font-family: 'Share Tech Mono', monospace; font-size: 1.3rem; color: var(--neon-cyan) !important; margin-bottom: 10px; }
.t-body { font-size: 0.95rem; line-height: 1.5; color: #eee !important; }

/* VISTA 2: SIMULADOR (FORO) */
.forum-console {
    width: 100%; max-width: 1000px; display: none; flex-direction: column;
    background-color: #000 !important; border: 1px solid #333; padding: 20px;
    border-radius: 10px; box-shadow: 0 0 30px rgba(0,0,0,0.8);
}

/* REPRODUCTOR DE TESTIMONIO */
.player-box {
    background-color: #111 !important; border: 1px solid var(--neon-pink);
    padding: 20px; border-radius: 5px; margin-bottom: 30px;
    display: flex; flex-direction: column; gap: 10px;
}
.player-label { color: var(--neon-pink) !important; font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; }
.transcript-text {
    font-size: 1.1rem; line-height: 1.6; color: #fff !important; font-style: italic;
    background: #050505; padding: 15px; border-left: 3px solid #333;
}

/* INTERACCI√ìN */
.analysis-board {
    display: flex; gap: 30px; flex-wrap: wrap;
}
.board-col { flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 15px; }
.col-head {
    color: #888; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;
    border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px;
}

/* BOTONES DE OPCI√ìN (S√ìLIDOS) */
.analysis-btn {
    background-color: var(--btn-solid) !important;
    color: #fff !important; padding: 15px; border: 1px solid #555 !important;
    cursor: pointer; text-align: left; border-radius: 4px; transition: 0.2s;
    display: flex; align-items: center; justify-content: space-between;
}
.analysis-btn:hover { background-color: #3d2566 !important; border-color: #fff !important; }
.analysis-btn.selected {
    background-color: var(--neon-cyan) !important; color: #000 !important;
    border-color: #fff !important; font-weight: bold;
}
.analysis-btn.correct {
    background-color: var(--neon-green) !important; color: #000 !important;
    border-color: #fff !important; pointer-events: none;
}
.analysis-btn.wrong {
    background-color: #ff3333 !important; color: #fff !important;
    animation: shake 0.3s;
}

/* FEEDBACK */
.console-feedback {
    margin-top: 25px; padding: 15px; background: #050505; border: 1px solid #333;
    font-family: 'Share Tech Mono', monospace; color: var(--neon-cyan); text-align: center;
}

@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

/* RESPONSIVE */
@media (max-width: 1200px) {
    .analysis-board { flex-direction: column; }
    .nav-audio-btn { width: 100%; }
}

</style>

<div id="voice-analyst-container">
    
    <!-- Animaci√≥n de fondo (Barras) -->
    <div class="sound-wave-container">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>

    <!-- HEADER -->
    <div class="audio-header">
        <h2 class="audio-title">Unidad 3: Violencias Espec√≠ficas</h2>
        <div class="audio-subtitle">An√°lisis de Riesgos y Estrategias de Prevenci√≥n</div>
    </div>

    <!-- NAV -->
    <div class="audio-nav">
        <button class="nav-audio-btn active" onclick="setAudioView('concepts')">üìä Tipolog√≠as</button>
        <button class="nav-audio-btn" onclick="setAudioView('sim')">üéôÔ∏è Mesa de An√°lisis</button>
    </div>

    <!-- CONTENIDO -->
    <div class="content-viewport">
        
        <!-- VISTA 1: TIPOLOG√çAS -->
        <div id="view-concepts" class="types-grid" style="display: grid;">
            <div class="type-card">
                <div class="t-header">Violencia F√≠sica</div>
                <div class="t-body">Agresiones corporales directas motivadas por prejuicio hacia la orientaci√≥n sexual o identidad de g√©nero.</div>
            </div>
            <div class="type-card">
                <div class="t-header">Violencia Simb√≥lica</div>
                <div class="t-body">Mensajes culturales, estereotipos y exclusiones sutiles que deslegitiman las identidades diversas.</div>
            </div>
            <div class="type-card">
                <div class="t-header">Violencia Institucional</div>
                <div class="t-body">Barreras administrativas, revictimizaci√≥n o negligencia por parte de funcionarios/as p√∫blicos.</div>
            </div>
            <div class="type-card">
                <div class="t-header">Microviolencias</div>
                <div class="t-body">Peque√±as agresiones cotidianas (ej: chistes, miradas, uso incorrecto de pronombres) que normalizan la discriminaci√≥n.</div>
            </div>
        </div>

        <!-- VISTA 2: SIMULADOR (FORO) -->
        <div id="view-sim" class="forum-console">
            
            <!-- REPRODUCTOR -->
            <div class="player-box">
                <div class="player-label">‚ñ∂ REPRODUCIENDO TESTIMONIO #01</div>
                <div class="transcript-text" id="transcript">
                    "Soy l√≠der LGBTIQ+. Ayer fui a la oficina local para actualizar mi riesgo. El vigilante se burl√≥ de mi ropa, y el funcionario me dijo que 'esas cosas' no son prioridad y que volviera otro d√≠a, a pesar de que tengo amenazas escritas."
                </div>
            </div>

            <!-- TABLERO DE AN√ÅLISIS -->
            <div class="analysis-board">
                <!-- Columna 1: Diagn√≥stico -->
                <div class="board-col">
                    <div class="col-head">1. DIAGN√ìSTICO: ¬øQU√â VIOLENCIA ES?</div>
                    <button class="analysis-btn" onclick="checkStep(1, 'fisica', this)">A. Violencia F√≠sica Directa</button>
                    <button class="analysis-btn" onclick="checkStep(1, 'inst', this)">B. Institucional y Microviolencias</button>
                    <button class="analysis-btn" onclick="checkStep(1, 'simb', this)">C. Solo Violencia Simb√≥lica</button>
                </div>

                <!-- Columna 2: Soluci√≥n -->
                <div class="board-col">
                    <div class="col-head">2. ESTRATEGIA: ¬øQU√â HACER?</div>
                    <button class="analysis-btn" onclick="checkStep(2, 'cap', this)">A. Capacitaci√≥n y Protocolo Diferencial</button>
                    <button class="analysis-btn" onclick="checkStep(2, 'nada', this)">B. Ignorar, fue un malentendido</button>
                    <button class="analysis-btn" onclick="checkStep(2, 'policia', this)">C. Llamar a la polic√≠a inmediatamente</button>
                </div>
            </div>

            <div class="console-feedback" id="feedback-txt">
                ESPERANDO AN√ÅLISIS DEL EXPERTO...
            </div>
            
            <button id="next-case-btn" class="nav-audio-btn" style="display:none; margin: 20px auto 0 auto; background:var(--neon-green)!important; color:black!important;" onclick="nextCase()">SIGUIENTE TESTIMONIO >></button>

        </div>

    </div>
</div>

<script>
// --- CONTROL DE VISTAS ---
function setAudioView(view) {
    document.querySelectorAll('.nav-audio-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');

    const concepts = document.getElementById('view-concepts');
    const sim = document.getElementById('view-sim');

    if (view === 'concepts') {
        sim.style.display = 'none';
        concepts.style.display = 'grid';
        gsap.from(".type-card", {y: 20, opacity: 0, stagger: 0.1});
    } else {
        concepts.style.display = 'none';
        sim.style.display = 'flex';
        gsap.from(".player-box", {scale: 0.95, opacity: 0});
    }
}

// --- L√ìGICA DEL SIMULADOR ---
const casesData = [
    {
        text: "\"Soy l√≠der LGBTIQ+. Ayer fui a la oficina local. El vigilante se burl√≥ de mi ropa, y el funcionario me dijo que 'esas cosas' no son prioridad y que volviera otro d√≠a, a pesar de que tengo amenazas.\"",
        correctViol: 'inst',
        correctSol: 'cap',
        fb: "CORRECTO. Es Violencia Institucional (barreras) y Microviolencias (burlas). Soluci√≥n: Capacitaci√≥n en trato digno y Protocolos Diferenciales."
    },
    {
        text: "\"En mi comunidad me prohibieron entrar al sal√≥n comunal por ser trans. Dicen que doy 'mal ejemplo'. Adem√°s, han aparecido grafitis amenazantes en mi puerta.\"",
        correctViol: 'simb',
        correctSol: 'riesgo', // Opci√≥n simulada en l√≥gica
        fb: "CORRECTO. Es Violencia Simb√≥lica (exclusi√≥n) y Amenaza (grafitis). Soluci√≥n: Activar ruta de riesgo espec√≠fica para l√≠deres."
    }
];

let currentCase = 0;
let step1Done = false;
let step2Done = false;

function checkStep(step, value, btn) {
    const feedback = document.getElementById('feedback-txt');
    const currentData = casesData[currentCase];

    // Resetear colores en esa columna
    let parent = btn.parentElement;
    parent.querySelectorAll('.analysis-btn').forEach(b => {
        b.classList.remove('selected', 'wrong', 'correct');
    });

    // Validar
    let isCorrect = false;
    if (step === 1 && value === currentData.correctViol) isCorrect = true;
    if (step === 2 && value === currentData.correctSol) isCorrect = true;
    
    // Caso especial para el caso 2 (ajuste din√°mico de botones)
    if (currentCase === 1 && step === 1 && value === 'simb') isCorrect = true;
    if (currentCase === 1 && step === 2 && value === 'cap') isCorrect = true; // Reutilizamos bot√≥n A para simplificar c√≥digo, idealmente cambiar texto

    if (isCorrect) {
        btn.classList.add('correct');
        if(step === 1) step1Done = true;
        if(step === 2) step2Done = true;
        
        if(step1Done && step2Done) {
            feedback.innerText = currentData.fb;
            feedback.style.color = "#39ff14";
            document.getElementById('next-case-btn').style.display = 'block';
        } else {
            feedback.innerText = "Diagn√≥stico parcial correcto. Contin√∫a...";
            feedback.style.color = "#00f3ff";
        }
    } else {
        btn.classList.add('wrong');
        feedback.innerText = "AN√ÅLISIS INCORRECTO. Revisa los conceptos.";
        feedback.style.color = "#ff007f";
    }
}

function nextCase() {
    currentCase++;
    if(currentCase < casesData.length) {
        // Cargar caso 2
        document.getElementById('transcript').innerText = casesData[currentCase].text;
        
        // Reset UI
        step1Done = false; step2Done = false;
        document.querySelectorAll('.analysis-btn').forEach(b => b.classList.remove('correct', 'wrong', 'selected'));
        document.getElementById('next-case-btn').style.display = 'none';
        document.getElementById('feedback-txt').innerText = "ESPERANDO AN√ÅLISIS...";
        document.getElementById('feedback-txt').style.color = "#00f3ff";
        
        // Cambiar textos de botones para Caso 2 (Truco r√°pido DOM)
        if(currentCase === 1) {
            const cols = document.querySelectorAll('.board-col');
            // Col 1
            cols[0].querySelectorAll('button')[0].innerText = "A. Violencia F√≠sica";
            cols[0].querySelectorAll('button')[1].innerText = "B. Violencia Institucional";
            cols[0].querySelectorAll('button')[2].innerText = "C. Violencia Simb√≥lica y Amenaza"; // Correcta
            // Col 2
            cols[1].querySelectorAll('button')[0].innerText = "A. Activar Ruta de Riesgo L√≠deres"; // Correcta (mapeada a 'cap')
            cols[1].querySelectorAll('button')[1].innerText = "B. Ignorar";
            cols[1].querySelectorAll('button')[2].innerText = "C. Medidas policivas simples";
        }
        
        gsap.from(".player-box", {opacity: 0, x: -20});
        
    } else {
        // Fin
        document.getElementById('view-sim').innerHTML = `<div style='text-align:center; padding:40px;'><h2 style='color:#39ff14'>¬°SESI√ìN COMPLETADA!</h2><p>Has identificado correctamente las violencias y sus estrategias de prevenci√≥n.</p></div>`;
    }
}

</script>