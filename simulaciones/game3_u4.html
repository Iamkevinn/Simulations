<!-- LIBRER√çAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=DM+Sans:wght@400;700&display=swap" rel="stylesheet">

<style>
/* --- ESTILO PAPER CUTOUT (SOMBRAS Y CAPAS) --- */
:root {
    --p-bg: #FEC82F;              /* Fondo papel c√°lido */

    --p-purple: #170047;          /* Estructura / t√≠tulos */
    --p-light-purple: #480241;    /* Subt√≠tulos / capas suaves */

    --p-yellow: #D23B78;          /* √ânfasis preventivo / foco emocional */
    --p-accent: #EE7D4F;          /* Detalles secundarios / apoyo visual */

    --shadow-depth: 4px 4px 0px rgba(0,0,0,0.2);
    --shadow-hover: 8px 8px 0px rgba(0,0,0,0.15);

    --font-head: 'Abril Fatface', cursive;
    --font-body: 'DM Sans', sans-serif;
}


#campaign-trail {
    width: 100%;
    min-height: 850px;
    height: auto;
    background-color: var(--p-purple);
    background-image: radial-gradient(var(--p-light-purple) 1px, transparent 1px);
    background-size: 20px 20px;
    position: relative;
    overflow: hidden;
    font-family: var(--font-body);
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    padding-bottom: 40px;
    border: 4px solid white;
}

/* --- DECORACI√ìN AMBIENTAL (Papelitos flotando) --- */
.confetti {
    position: absolute; width: 10px; height: 10px;
    background: var(--p-yellow);
    animation: floatPaper 6s infinite ease-in-out;
    opacity: 0.7; z-index: 0;
}
.confetti:nth-child(2n) { background: var(--p-accent); width: 15px; height: 15px; animation-duration: 8s; }
.confetti:nth-child(3n) { background: white; border-radius: 50%; animation-duration: 10s; }

@keyframes floatPaper {
    0% { transform: translateY(800px) rotate(0deg); opacity: 0; }
    20% { opacity: 1; }
    100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
}

/* --- HEADER --- */
.paper-header {
    text-align: center; padding: 30px; position: relative; z-index: 10;
}
.paper-badge {
    background: var(--p-yellow); color: white; display: inline-block;
    padding: 8px 20px; font-weight: bold; transform: rotate(-2deg);
    box-shadow: var(--shadow-depth); border: 2px solid white;
    margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;
}
.paper-title {
    font-family: var(--font-head); font-size: clamp(2rem, 5vw, 3.5rem);
    color: white; text-shadow: 4px 4px 0px #000; margin: 0;
    line-height: 1.1;
}
.paper-subtitle { color: #e0c3fc; margin-top: 10px; font-size: 1.1rem; }

/* --- MAPA DE RUTA (Vertical para Responsive) --- */
.map-container {
    flex: 1; display: flex; flex-direction: column; align-items: center;
    position: relative; z-index: 5; padding: 20px;
}

/* L√≠nea de tiempo */
.timeline-line {
    position: absolute; top: 0; bottom: 0; left: 50%; width: 4px;
    background: rgba(255,255,255,0.3); transform: translateX(-50%); z-index: 0;
}

/* Nodos (Casillas) */
.map-node {
    background: white; width: 80%; max-width: 500px;
    padding: 25px; margin-bottom: 40px;
    border-radius: 2px; border: 2px solid #000;
    box-shadow: 10px 10px 0px rgba(0,0,0,0.2);
    position: relative; z-index: 2;
    transition: transform 0.3s;
    display: flex; flex-direction: column; align-items: center; text-align: center;
}

/* Estados del Nodo */
.map-node.locked { filter: grayscale(1); opacity: 0.6; pointer-events: none; }
.map-node.active { transform: scale(1.02) rotate(1deg); border-color: var(--p-yellow); }
.map-node.completed { border-color: var(--p-accent); }
.map-node.completed::after {
    content: '‚òÖ'; position: absolute; top: -15px; right: -15px;
    background: var(--p-accent); color: white; width: 40px; height: 40px;
    border-radius: 50%; font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
    border: 2px solid black; box-shadow: 3px 3px 0 black;
}

.node-icon { font-size: 3rem; margin-bottom: 10px; }
.node-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; color: #000; }
.node-desc { font-size: 0.95rem; color: #555; line-height: 1.5; margin-bottom: 20px; }

/* ZONA DE CARTAS (MANO DEL JUGADOR) */
/* Solo aparece cuando un nodo est√° activo */
.hand-area {
    display: none; /* Se activa con JS */
    gap: 10px; flex-wrap: wrap; justify-content: center; width: 100%;
    margin-top: 10px;
}

.strategy-card {
    background: var(--p-purple); color: white;
    width: 140px; padding: 15px;
    border: 2px solid white; border-radius: 8px;
    cursor: pointer; text-align: center;
    box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
    transition: transform 0.2s; position: relative;
}
.strategy-card:hover { transform: translateY(-10px) rotate(2deg); background: var(--p-light-purple); }
.card-ico { font-size: 2rem; display: block; margin-bottom: 5px; }
.card-txt { font-size: 0.8rem; font-weight: bold; line-height: 1.2; }

/* FEEDBACK (Sello) */
.stamp {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg) scale(0);
    border: 5px solid var(--p-accent); color: var(--p-accent);
    padding: 10px 20px; font-weight: 900; font-size: 2rem;
    text-transform: uppercase; background: rgba(255,255,255,0.9);
    z-index: 10; pointer-events: none; opacity: 0;
}

/* AVATAR DE LA LIDERESA (Token) */
.leader-token {
    width: 60px; height: 60px; background: #fff;
    border: 2px solid #000; border-radius: 50%;
    position: absolute; top: 0; left: 50%; transform: translate(-50%, -50%);
    z-index: 10; display: flex; align-items: center; justify-content: center;
    font-size: 2rem; box-shadow: 0 5px 10px rgba(0,0,0,0.3);
    transition: top 1s cubic-bezier(0.5, 0, 0, 1);
}

/* RESPONSIVE */
@media (max-width: 1200px) {
    .paper-title { font-size: 2rem; }
    .map-node { width: 90%; padding: 20px; }
    .strategy-card { width: 100%; flex-direction: row; display: flex; align-items: center; gap: 10px; text-align: left; padding: 10px; }
    .card-ico { margin: 0; }
}

</style>

<div id="campaign-trail">
    
    <!-- Decoraci√≥n -->
    <div class="confetti" style="left:10%"></div>
    <div class="confetti" style="left:30%; animation-delay:1s"></div>
    <div class="confetti" style="left:70%; animation-delay:2s"></div>
    <div class="confetti" style="left:90%; animation-delay:0.5s"></div>

    <div class="paper-header">
        <div class="paper-badge">MISI√ìN 3: DEMOCRACIA INCLUSIVA</div>
        <h1 class="paper-title">La Ruta del Liderazgo</h1>
        <p class="paper-subtitle">Ayuda a la lideresa a superar las barreras estructurales usando las cartas correctas.</p>
    </div>

    <div class="map-container">
        <div class="timeline-line"></div>
        
        <!-- TOKEN (Se mueve por JS) -->
        <div class="leader-token" id="player-token">üë©üèΩ‚Äç‚öñÔ∏è</div>

        <!-- NODO 1: INICIO -->
        <div class="map-node active" id="node-0">
            <div class="node-icon">üöß</div>
            <div class="node-title">OBST√ÅCULO 1: EXCLUSI√ìN</div>
            <p class="node-desc">
                Las listas al congreso est√°n dominadas por hombres. A la lideresa le niegan el aval por "falta de espacio".<br>
                <strong>¬øQu√© mecanismo garantiza su participaci√≥n?</strong>
            </p>
            
            <!-- Cartas Nodo 1 -->
            <div class="hand-area" id="hand-0" style="display:flex;">
                <div class="strategy-card" onclick="playCard(0, false)">
                    <span class="card-ico">üì¢</span>
                    <span class="card-txt">Protesta individual</span>
                </div>
                <div class="strategy-card" onclick="playCard(0, true)">
                    <span class="card-ico">‚öñÔ∏è</span>
                    <span class="card-txt">Paridad y Alternancia</span>
                </div>
                <div class="strategy-card" onclick="playCard(0, false)">
                    <span class="card-ico">ü§∑</span>
                    <span class="card-txt">Renunciar</span>
                </div>
            </div>
            <div class="stamp" id="stamp-0">SUPERADO</div>
        </div>

        <!-- NODO 2: FINANCIACI√ìN -->
        <div class="map-node locked" id="node-1">
            <div class="node-icon">üí∏</div>
            <div class="node-title">OBST√ÅCULO 2: SIN RECURSOS</div>
            <p class="node-desc">
                La campa√±a avanza, pero no hay dinero para transporte ni publicidad. Los bancos niegan cr√©ditos.<br>
                <strong>¬øQu√© estrategia estructural se requiere?</strong>
            </p>
            
            <!-- Cartas Nodo 2 -->
            <div class="hand-area" id="hand-1">
                <div class="strategy-card" onclick="playCard(1, true)">
                    <span class="card-ico">üí∞</span>
                    <span class="card-txt">Acceso a Financiamiento P√∫blico</span>
                </div>
                <div class="strategy-card" onclick="playCard(1, false)">
                    <span class="card-ico">üé∞</span>
                    <span class="card-txt">Rifas vecinales</span>
                </div>
                <div class="strategy-card" onclick="playCard(1, false)">
                    <span class="card-ico">üè¶</span>
                    <span class="card-txt">Pr√©stamo Gota a Gota</span>
                </div>
            </div>
            <div class="stamp" id="stamp-1">APROBADO</div>
        </div>

        <!-- NODO 3: VIOLENCIA -->
        <div class="map-node locked" id="node-2">
            <div class="node-icon">üî•</div>
            <div class="node-title">OBST√ÅCULO 3: VIOLENCIA POL√çTICA</div>
            <p class="node-desc">
                La lideresa recibe amenazas para que abandone su candidatura. Es violencia pol√≠tica por raz√≥n de g√©nero.<br>
                <strong>¬øQu√© acci√≥n protege su vida y liderazgo?</strong>
            </p>
            
            <!-- Cartas Nodo 3 -->
            <div class="hand-area" id="hand-2">
                <div class="strategy-card" onclick="playCard(2, false)">
                    <span class="card-ico">üè†</span>
                    <span class="card-txt">Esconderse en casa</span>
                </div>
                <div class="strategy-card" onclick="playCard(2, false)">
                    <span class="card-ico">üî´</span>
                    <span class="card-txt">Armarse</span>
                </div>
                <div class="strategy-card" onclick="playCard(2, true)">
                    <span class="card-ico">üõ°Ô∏è</span>
                    <span class="card-txt">Ruta de Protecci√≥n UNP</span>
                </div>
            </div>
            <div class="stamp" id="stamp-2">PROTEGIDA</div>
        </div>

        <!-- META -->
        <div class="map-node locked" id="node-3" style="border-color:var(--p-accent);">
            <div class="node-icon">üèõÔ∏è</div>
            <div class="node-title">META: DEMOCRACIA INCLUSIVA</div>
            <p class="node-desc">
                ¬°Lo lograste! La lideresa ha llegado a espacios de representaci√≥n gracias a las garant√≠as constitucionales y la protecci√≥n efectiva.
            </p>
            <div style="font-size:3rem;">üéâüó≥Ô∏èüíú</div>
        </div>

    </div>
</div>

<script>
// --- L√ìGICA DEL JUEGO DE RUTA ---

let currentLevel = 0;
const totalLevels = 3;

// Feedback textual para alertas (simple y directo)
const feedbackMessages = [
    "¬°Exacto! La Paridad y Alternancia son mecanismos legales para garantizar la inclusi√≥n en las listas.",
    "¬°Correcto! El Estado debe garantizar Acceso a Financiaci√≥n para que la pol√≠tica no sea solo para ricos.",
    "¬°As√≠ es! La UNP y las instituciones deben activar rutas de protecci√≥n ante la violencia pol√≠tica."
];

function playCard(levelIndex, isCorrect) {
    if(levelIndex !== currentLevel) return; // Evitar clicks en niveles futuros

    const currentNode = document.getElementById(`node-${levelIndex}`);
    const stamp = document.getElementById(`stamp-${levelIndex}`);
    const hand = document.getElementById(`hand-${levelIndex}`);

    if (isCorrect) {
        // 1. ANIMACI√ìN DE √âXITO (SELLO)
        gsap.to(stamp, {scale: 1, opacity: 1, rotation: 0, duration: 0.5, ease: "back.out(1.7)"});
        currentNode.classList.remove('active');
        currentNode.classList.add('completed');
        
        // Ocultar cartas usadas
        gsap.to(hand, {height: 0, opacity: 0, duration: 0.5, display: 'none'});

        // Feedback r√°pido
        // (Opcional: podr√≠as mostrar un toast, pero el sello es bastante claro)

        // 2. MOVER JUGADOR
        currentLevel++;
        moveToken(currentLevel);

        // 3. DESBLOQUEAR SIGUIENTE NIVEL
        if (currentLevel < totalLevels) {
            const nextNode = document.getElementById(`node-${currentLevel}`);
            const nextHand = document.getElementById(`hand-${currentLevel}`);
            
            nextNode.classList.remove('locked');
            nextNode.classList.add('active');
            
            // Mostrar cartas del siguiente nivel
            nextHand.style.display = 'flex';
            gsap.from(nextHand.children, {y: 20, opacity: 0, stagger: 0.1, delay: 1});
        } else {
            // VICTORIA FINAL
            const finalNode = document.getElementById('node-3');
            finalNode.classList.remove('locked');
            finalNode.classList.add('completed');
            gsap.from(finalNode, {scale: 1.1, duration: 0.5, yoyo: true, repeat: 1});
        }

    } else {
        // ERROR (Vibraci√≥n)
        gsap.to(currentNode, {x: 10, duration: 0.1, yoyo: true, repeat: 5});
        alert("Esa estrategia no es suficiente o es incorrecta. Intenta usar una herramienta estructural o institucional.");
    }
}

function moveToken(levelIndex) {
    // Calcular posici√≥n del siguiente nodo
    const nextNode = document.getElementById(`node-${levelIndex}`);
    // Simular movimiento vertical relativo al contenedor
    // En una implementaci√≥n real compleja usar√≠amos getBoundingClientRect, 
    // pero aqu√≠, al ser vertical stack, podemos asumir que baja al siguiente bloque visualmente.
    
    // Hack visual simple: Mover el token dentro del siguiente nodo activo
    // Pero como el token es absolute al contenedor, calculamos top.
    
    // Mejor enfoque para dise√±o fluido: 
    // Dejar que el token flote hasta la posici√≥n del nodo.
    
    const containerRect = document.querySelector('.map-container').getBoundingClientRect();
    const nodeRect = nextNode.getBoundingClientRect();
    
    // Posici√≥n relativa al contenedor padre
    const relativeTop = nodeRect.top - containerRect.top + (nodeRect.height / 2);
    
    const token = document.getElementById('player-token');
    token.style.top = relativeTop + "px";
}

// Inicializar posici√≥n del token en el nodo 0
setTimeout(() => moveToken(0), 500);
window.addEventListener('resize', () => moveToken(currentLevel));

</script>