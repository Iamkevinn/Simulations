<!-- Cargar GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">

<style>
/* --- 1. EST√âTICA DE PREVENCI√ìN (Violeta/Naranja/Blanco) --- */
:root {
    --primary-purple: #6f42c1;
    --light-purple: #e0cffc;
    --alert-orange: #fd7e14;
    --success-teal: #20c997;
    --danger-rose: #e83e8c;
    --bg-gradient: linear-gradient(135deg, #f3f0ff 0%, #e6dbff 100%);
    --card-shadow: 0 10px 30px rgba(111, 66, 193, 0.15);
    --text-dark: #343a40;
}

#route-builder-container {
    width: 100%;
    /* Altura m√≠nima flexible, se ajusta al contenido en m√≥vil */
    min-height: 600px;
    height: auto;
    background: var(--bg-gradient);
    position: relative;
    overflow: hidden;
    font-family: 'Poppins', sans-serif;
    color: var(--text-dark);
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box; /* Crucial para responsive */
}

/* Fondo con Ondas (Ajustado con porcentajes para ser responsive) */
.wave {
    position: absolute;
    width: 150%; /* Relativo al contenedor */
    padding-bottom: 150%; /* Truco para mantener proporci√≥n circular */
    border-radius: 40%;
    background: rgba(111, 66, 193, 0.05);
    animation: rotateWave 15s infinite linear;
    z-index: 0;
    pointer-events: none;
}
.wave:nth-child(1) { top: -50%; left: -25%; animation-duration: 25s; }
.wave:nth-child(2) { bottom: -50%; right: -25%; animation-direction: reverse; background: rgba(253, 126, 20, 0.05); }

@keyframes rotateWave {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* --- 2. HEADER INFORMATIVO --- */
.header-box {
    text-align: center;
    position: relative;
    z-index: 10;
    margin-bottom: 20px;
}
.header-title {
    font-family: 'Roboto Slab', serif;
    color: var(--primary-purple);
    font-size: clamp(1.4rem, 4vw, 1.8rem); /* Fuente escalable */
    margin: 0;
    line-height: 1.2;
}
.header-subtitle {
    font-size: clamp(0.8rem, 3vw, 0.9rem);
    color: #666;
    max-width: 600px;
    margin: 10px auto;
}

/* --- 3. √ÅREA DE JUEGO (TARJETAS) --- */
.game-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* Centrado vertical */
    position: relative;
    z-index: 10;
    width: 100%;
}

/* Tarjeta Flexible */
.reflection-card {
    background: white;
    width: 100%;
    max-width: 500px;
    /* Altura autom√°tica basada en contenido */
    min-height: 200px;
    height: auto; 
    border-radius: 20px;
    box-shadow: var(--card-shadow);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 30px;
    text-align: center;
    position: relative;
    transform-style: preserve-3d;
    border-top: 5px solid var(--primary-purple);
    margin-bottom: 30px;
}

.card-content h3 {
    font-size: 1.2rem;
    margin-bottom: 10px;
    color: var(--text-dark);
}
.card-content p {
    font-size: 0.95rem;
    color: #777;
    margin: 0;
    line-height: 1.5;
}

/* Botones Responsivos */
.decision-controls {
    display: flex;
    gap: 15px;
    width: 100%;
    max-width: 800px;
    justify-content: center;
    flex-wrap: wrap; /* Permite que bajen en m√≥viles */
}

.decision-btn {
    flex: 1 1 150px; /* Base 150px, pero crece */
    padding: 15px 10px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s;
    font-family: 'Poppins', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center; /* Centrar contenido */
    gap: 8px;
    font-size: 0.9rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.btn-critical { background: white; color: var(--danger-rose); border: 2px solid var(--danger-rose); }
.btn-critical:hover, .btn-critical:active { background: var(--danger-rose); color: white; transform: translateY(-3px); }

.btn-good { background: white; color: var(--success-teal); border: 2px solid var(--success-teal); }
.btn-good:hover, .btn-good:active { background: var(--success-teal); color: white; transform: translateY(-3px); }

.btn-improve { background: white; color: var(--alert-orange); border: 2px solid var(--alert-orange); }
.btn-improve:hover, .btn-improve:active { background: var(--alert-orange); color: white; transform: translateY(-3px); }

/* --- 4. RUTA (PROGRESS BAR) --- */
.route-visualizer {
    width: 100%;
    height: 80px; /* Un poco m√°s compacta */
    background: white;
    border-radius: 15px;
    margin-top: 30px;
    position: relative;
    display: flex;
    align-items: center;
    padding: 0 20px;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
    z-index: 10;
    box-sizing: border-box;
}

.route-track {
    width: 100%;
    height: 6px;
    background: #eee;
    border-radius: 3px;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.route-node {
    width: 20px;
    height: 20px;
    background: #ccc;
    border-radius: 50%;
    position: relative;
    z-index: 2;
    transition: 0.5s;
    flex-shrink: 0; /* Evita que se aplasten */
}
.route-node.active { background: var(--primary-purple); box-shadow: 0 0 0 4px var(--light-purple); transform: scale(1.2); }

.route-progress-bar {
    position: absolute; left: 0; top: 0; height: 100%;
    background: var(--primary-purple); width: 0%;
    border-radius: 3px; transition: width 0.5s ease-in-out;
}

/* --- 5. MEDIA QUERIES (Ajustes Espec√≠ficos para M√≥vil) --- */
@media (max-width: 600px) {
    #route-builder-container { padding: 15px; min-height: auto; }
    
    .reflection-card { padding: 20px; margin-bottom: 20px; }
    .card-content h3 { font-size: 1.1rem; }
    
    /* Botones ocupan ancho completo en m√≥vil para f√°cil click */
    .decision-controls { flex-direction: column; gap: 10px; }
    .decision-btn { width: 100%; flex: none; padding: 12px; }
    
    /* Ajustar nodos de la ruta */
    .route-visualizer { height: 60px; padding: 0 10px; margin-top: 20px; }
    .route-node { width: 12px; height: 12px; }
    .route-node.active { box-shadow: 0 0 0 3px var(--light-purple); }
}

/* Feedback Overlay */
.feedback-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255,255,255,0.95);
    z-index: 50;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
}
.feedback-text { font-size: 1.1rem; color: var(--text-dark); margin-bottom: 20px; font-weight: bold; }
.next-btn {
    background: var(--primary-purple); color: white; padding: 12px 30px; 
    border-radius: 30px; border: none; cursor: pointer; font-size: 1rem;
    box-shadow: 0 4px 10px rgba(111, 66, 193, 0.3);
}

</style>

<div id="route-builder-container">
    <div class="wave"></div>
    <div class="wave"></div>

    <div class="header-box">
        <h2 class="header-title">Construcci√≥n de Rutas de Protecci√≥n</h2>
        <p class="header-subtitle">
            Juego 5: Reflexiona y clasifica los siguientes conceptos para construir una ruta institucional s√≥lida y segura.
        </p>
    </div>

    <!-- √Årea Central del Juego -->
    <div class="game-area">
        <div class="reflection-card" id="current-card">
            <div class="card-content">
                <h3 id="card-title">Cargando...</h3>
                <p id="card-desc">...</p>
            </div>
        </div>

        <div class="decision-controls">
            <button class="decision-btn btn-critical" onclick="makeDecision('critico')">
                ‚ö†Ô∏è Punto Cr√≠tico
            </button>
            <button class="decision-btn btn-good" onclick="makeDecision('buena')">
                ‚úÖ Buena Pr√°ctica
            </button>
            <button class="decision-btn btn-improve" onclick="makeDecision('mejora')">
                üõ†Ô∏è Acci√≥n de Mejora
            </button>
        </div>
    </div>

    <!-- Barra de Progreso (La Ruta) -->
    <div class="route-visualizer">
        <div class="route-track">
            <div class="route-progress-bar" id="progress-bar"></div>
            <!-- Nodos generados din√°micamente -->
            <div class="route-node" id="node-0"></div>
            <div class="route-node" id="node-1"></div>
            <div class="route-node" id="node-2"></div>
            <div class="route-node" id="node-3"></div>
            <div class="route-node" id="node-4"></div>
            <div class="route-node" id="node-5"></div>
        </div>
    </div>

    <!-- Pantalla de Feedback -->
    <div class="feedback-overlay" id="feedback-screen">
        <div class="feedback-icon" id="fb-icon" style="font-size: 3rem; margin-bottom: 10px;">‚ú®</div>
        <div class="feedback-text" id="fb-text">Correcto</div>
        <button class="next-btn" onclick="nextCard()">Siguiente Tramo</button>
    </div>

</div>

<script>
// --- DATOS SENSIBLES DEL CURSO (Intactos) ---
const gameData = [
    {
        title: "Revictimizaci√≥n",
        desc: "Cuando la instituci√≥n hace que la v√≠ctima reviva el trauma innecesariamente.",
        type: "critico",
        feedback: "¬°Exacto! La revictimizaci√≥n es un PUNTO CR√çTICO grave que debemos identificar y eliminar de la ruta."
    },
    {
        title: "Protocolos con enfoque de g√©nero",
        desc: "Documentos que gu√≠an la atenci√≥n reconociendo las desigualdades.",
        type: "buena",
        feedback: "Correcto. Implementar estos protocolos es una BUENA PR√ÅCTICA fundamental para la prevenci√≥n."
    },
    {
        title: "Violencia Institucional",
        desc: "Trato deshumanizante o negligente por parte de funcionarios.",
        type: "critico",
        feedback: "Muy bien. Identificar la violencia institucional como un PUNTO CR√çTICO es el primer paso para erradicarla."
    },
    {
        title: "Capacitaci√≥n permanente",
        desc: "Formaci√≥n constante del personal en derechos y g√©nero.",
        type: "mejora",
        feedback: "As√≠ es. La capacitaci√≥n no debe ser √∫nica, es una ACCI√ìN DE MEJORA continua para evitar fallos."
    },
    {
        title: "Rutas claras de atenci√≥n",
        desc: "Pasos definidos y conocidos por la comunidad para denunciar.",
        type: "buena",
        feedback: "Correcto. Tener rutas claras es una BUENA PR√ÅCTICA que salva vidas al reducir tiempos de respuesta."
    },
    {
        title: "Evaluaciones de riesgo territoriales",
        desc: "Analizar el peligro teniendo en cuenta el contexto local.",
        type: "mejora",
        feedback: "Exacto. Incorporar el enfoque territorial es una ACCI√ìN DE MEJORA clave frente a evaluaciones gen√©ricas."
    }
];

let currentIndex = 0;
const totalSteps = gameData.length;

// Inicializar juego
function loadCard() {
    const card = document.getElementById('current-card');
    const title = document.getElementById('card-title');
    const desc = document.getElementById('card-desc');
    
    // Animaci√≥n de entrada
    gsap.fromTo(card, {y: 20, opacity: 0, rotateX: -10}, {y: 0, opacity: 1, rotateX: 0, duration: 0.5});

    title.innerText = gameData[currentIndex].title;
    desc.innerText = gameData[currentIndex].desc;
}

// L√≥gica de Decisi√≥n
function makeDecision(choice) {
    const correctType = gameData[currentIndex].type;
    const feedbackScreen = document.getElementById('feedback-screen');
    const fbText = document.getElementById('fb-text');
    const fbIcon = document.getElementById('fb-icon');

    if (choice === correctType) {
        fbIcon.innerText = "‚ú®";
        fbText.innerText = gameData[currentIndex].feedback;
        fbText.style.color = "var(--primary-purple)";
        updateRoute();
    } else {
        fbIcon.innerText = "ü§î";
        fbText.innerText = "Anal√≠zalo de nuevo... " + getHint(correctType);
        fbText.style.color = "#d63384";
    }

    feedbackScreen.style.display = 'flex';
    gsap.from(feedbackScreen, {opacity: 0, duration: 0.3});
}

function getHint(type) {
    if(type === 'critico') return "Esto representa un obst√°culo o da√±o en la atenci√≥n.";
    if(type === 'buena') return "Esto es algo que ya funciona y debemos mantener.";
    if(type === 'mejora') return "Esto es algo que falta fortalecer.";
}

// Avanzar
function nextCard() {
    document.getElementById('feedback-screen').style.display = 'none';
    currentIndex++;

    if (currentIndex < totalSteps) {
        loadCard();
    } else {
        showFinalVictory();
    }
}

// Actualizar visualizador de ruta
function updateRoute() {
    const progress = ((currentIndex + 1) / totalSteps) * 100;
    document.getElementById('progress-bar').style.width = progress + "%";
    
    const node = document.getElementById(`node-${currentIndex}`);
    if(node) node.classList.add('active');
}

// Pantalla Final
function showFinalVictory() {
    const card = document.getElementById('current-card');
    card.innerHTML = `
        <h3 style="color:var(--success-teal)">¬°Ruta Completada!</h3>
        <p style="margin-bottom:20px;">Has identificado correctamente los componentes clave.</p>
        <div style="font-size:3rem;">üõ°Ô∏èüíú</div>
    `;
    
    // Ocultar botones
    document.querySelector('.decision-controls').style.display = 'none';
    
    gsap.to(card, {scale: 1.05, duration: 0.5, ease: "back.out(1.7)"});
    gsap.to("#route-builder-container", {background: "linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%)", duration: 2});
}

loadCard();

</script>