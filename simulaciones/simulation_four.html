<!-- ESTILOS CSS (DISE√ëO TIPO WINDOWS/TEAMS MEJORADO) -->
<style>
    /* Reset b√°sico para asegurar que encaje en Elementor */
    .desktop-sim-container * { box-sizing: border-box; }

    /* CONTENEDOR PRINCIPAL (EL ESCRITORIO) */
    .desktop-sim-container {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        width: 100%;
        max-width: 700px;
        height: 550px; /* Altura fija para contener todo */
        margin: 0 auto;
        background: url('https://images.unsplash.com/photo-1542435503-956c469947f6?ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=80') center/cover no-repeat;
        position: relative;
        border-radius: 8px;
        overflow: hidden; /* Nada se sale del escritorio */
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        border: 1px solid #aaa;
    }

    /* BARRA DE TAREAS (ABAJO) */
    .sim-taskbar {
        position: absolute; bottom: 0; left: 0; width: 100%; height: 40px;
        background: rgba(20, 20, 20, 0.95);
        display: flex; align-items: center; padding: 0 15px; gap: 15px;
        color: white; font-size: 13px; z-index: 20;
    }
    .sim-start-icon { font-size: 18px; cursor: pointer; }
    .sim-app-icon { 
        background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 4px; 
        border-bottom: 2px solid #7eb4ea; cursor: default;
    }
    .sim-clock { margin-left: auto; font-family: monospace; }

    /* VENTANA DE CORREO (FONDO) */
    .sim-window-email {
        position: absolute; top: 30px; left: 30px; right: 30px; bottom: 80px;
        background: #fff; border-radius: 6px; 
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        display: flex; flex-direction: column;
        z-index: 1; /* Al fondo */
        border: 1px solid #ccc;
    }
    .email-header { background: #0078d4; color: white; padding: 8px 15px; font-size: 13px; font-weight: 600; display: flex; justify-content: space-between; }
    .email-content { padding: 30px; color: #333; font-size: 14px; line-height: 1.5; }
    .email-btn { 
        background: #0078d4; color: white; border: none; padding: 10px 20px; 
        border-radius: 4px; margin-top: 20px; width: fit-content; opacity: 0.6; cursor: not-allowed; 
    }

    /* VENTANA DE CHAT (TIPO TEAMS - FLOTANTE) */
    .sim-window-chat {
        position: absolute; bottom: 50px; right: 20px;
        width: 320px; height: 420px;
        background: #f5f5f5;
        border-radius: 8px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        display: flex; flex-direction: column;
        z-index: 100; /* Encima de todo */
        border: 1px solid #d1d1d1;
        font-size: 13px;
    }
    .chat-top-bar {
        background: #5b5fc7; /* Color Teams */
        color: white; padding: 10px 15px;
        border-radius: 8px 8px 0 0;
        display: flex; align-items: center; gap: 10px; font-weight: bold;
    }
    .boss-avatar { width: 28px; height: 28px; background: #88bc47; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 12px; border: 1px solid #fff; }
    
    /* CUERPO DEL CHAT (SCROLL) */
    .chat-scroll-area {
        flex: 1; /* Ocupa el espacio disponible */
        padding: 15px;
        overflow-y: auto; /* Scroll autom√°tico */
        display: flex; flex-direction: column; gap: 10px;
        background: #fff;
    }
    
    /* BURBUJAS DE MENSAJE */
    .bubble { 
        padding: 10px 14px; border-radius: 8px; max-width: 85%; line-height: 1.4; 
        position: relative; word-wrap: break-word; /* Evita desborde de texto */
        animation: popIn 0.3s ease;
    }
    .b-boss { 
        background: #f0f0f0; color: #242424; align-self: flex-start; 
        border-radius: 0 10px 10px 10px; border-left: 3px solid #88bc47;
    }
    .b-user { 
        background: #e1eafc; color: #242424; align-self: flex-end; 
        border-radius: 10px 0 10px 10px; 
    }
    .sys-note {
        font-size: 11px; text-align: center; color: #d9534f; 
        background: #fff5f5; padding: 5px; border-radius: 4px;
        margin: 5px 0; border: 1px dashed #d9534f;
    }

    /* √ÅREA DE ESCRIBIR (OPCIONES) */
    .chat-input-zone {
        padding: 10px; background: #f0f0f0; border-top: 1px solid #ddd;
        min-height: 60px; display: flex; flex-direction: column; justify-content: center;
        border-radius: 0 0 8px 8px;
    }
    
    /* BOTONES DE OPCIONES */
    .opt-btn {
        background: white; border: 1px solid #5b5fc7; color: #5b5fc7;
        padding: 8px 12px; margin-bottom: 5px; border-radius: 4px;
        cursor: pointer; text-align: left; transition: 0.2s; font-size: 12px;
        width: 100%;
    }
    .opt-btn:hover { background: #5b5fc7; color: white; }

    /* INDICADOR DE ESCRIBIENDO */
    .typing-dots {
        display: none; align-self: flex-start; background: #f0f0f0;
        padding: 5px 10px; border-radius: 10px; margin-bottom: 10px; width: fit-content;
    }
    .dot {
        display: inline-block; width: 6px; height: 6px; background: #999;
        border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; margin: 0 2px;
    }
    .dot:nth-child(1) { animation-delay: -0.32s; }
    .dot:nth-child(2) { animation-delay: -0.16s; }

    /* MEDIDORES DE ESTADO (HUD) */
    .stats-hud {
        position: absolute; top: 10px; left: 10px; width: 200px;
        background: rgba(0,0,0,0.85); padding: 12px;
        border-radius: 6px; color: white; font-size: 11px; z-index: 50;
    }
    .stat-label { display: flex; justify-content: space-between; margin-bottom: 3px; }
    .stat-track { background: #444; height: 6px; border-radius: 3px; margin-bottom: 8px; overflow: hidden; }
    .stat-bar { height: 100%; transition: width 0.4s ease; }

    /* PANTALLA FINAL */
    .end-screen {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255,255,255,0.98); z-index: 200;
        display: none; flex-direction: column; justify-content: center; align-items: center;
        text-align: center; padding: 40px; color: #333;
    }

    /* Animaciones */
    @keyframes popIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    .vibrate { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

</style>

<div class="desktop-sim-container" id="simContainer">

    <!-- 1. HUD DE ESTADO -->
    <div class="stats-hud">
        <div class="stat-label"><span>üíº Estabilidad Laboral</span><span id="txtJob">100%</span></div>
        <div class="stat-track"><div class="stat-bar" id="barJob" style="width:100%; background:#0078d4;"></div></div>
        
        <div class="stat-label"><span>üõ°Ô∏è Dignidad / L√≠mites</span><span id="txtDig">100%</span></div>
        <div class="stat-track"><div class="stat-bar" id="barDig" style="width:100%; background:#e81123;"></div></div>
    </div>

    <!-- 2. VENTANA DE CORREO (FONDO) -->
    <div class="sim-window-email">
        <div class="email-header">
            <span>‚úâÔ∏è Redactar: Informe Mensual</span>
            <span>‚úï</span>
        </div>
        <div class="email-content">
            <p><strong>Para:</strong> Gerencia Comercial<br><strong>Asunto:</strong> Cierre de Mes</p>
            <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">
            <p>Adjunto env√≠o el informe de ventas correspondiente a este mes.</p>
            <p>Quedo atenta a sus comentarios.</p>
            <br>
            <p style="color:#888;">Andrea G√≥mez<br>Analista Jr.</p>
            <button class="email-btn">Enviar (Bloqueado)</button>
        </div>
    </div>

    <!-- 3. VENTANA DE CHAT -->
    <div class="sim-window-chat" id="chatWindow">
        <div class="chat-top-bar">
            <div class="boss-avatar">RJ</div>
            <div>Ricardo (Jefe) <span style="font-weight:normal; font-size:11px; opacity:0.8;">‚Ä¢ En l√≠nea</span></div>
        </div>
        
        <!-- √Årea de Mensajes (Historial) -->
        <div class="chat-scroll-area" id="chatHistory">
            <div style="text-align:center; color:#999; font-size:11px; margin-bottom:10px;">Hoy, 4:50 PM</div>
            <!-- Los mensajes se acumulan aqu√≠, no se borran -->
            <div class="typing-dots" id="typingDots">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            </div>
        </div>

        <!-- √Årea de Inputs -->
        <div class="chat-input-zone" id="inputZone">
            <!-- Botones JS -->
        </div>
    </div>

    <!-- 4. BARRA DE TAREAS -->
    <div class="sim-taskbar">
        <div class="sim-start-icon">ü™ü</div>
        <div class="sim-app-icon">üí¨ Chat</div>
        <div style="opacity:0.6">‚úâÔ∏è Correo</div>
        <div class="sim-clock">16:55</div>
    </div>

    <!-- 5. PANTALLA FINAL -->
    <div class="end-screen" id="endScreen">
        <h2 id="endTitle" style="color:#222; margin-bottom:10px; font-size:24px;">Resultado</h2>
        <div id="endDesc" style="font-size:16px; line-height:1.6; max-width:450px; color:#555;"></div>
        
        <div style="background:#f9f9f9; padding:20px; margin-top:30px; border-left:4px solid #5b5fc7; text-align:left; font-size:13px; max-width:450px;">
            <strong>‚öñÔ∏è Ley 1010 de 2006 (Colombia):</strong><br>
            El acoso laboral incluye toda conducta persistente y demostrable que busque infundir miedo, intimidaci√≥n o inducir la renuncia.
            <br><br>
            <strong>Se√±ales identificadas:</strong> Invasi√≥n de privacidad, comentarios sugestivos ("mijita", "princesa") y represalias por rechazo.
        </div>
        <button onclick="location.reload()" style="margin-top:20px; padding:12px 25px; border:none; background:#333; color:white; cursor:pointer; border-radius:5px;">Reiniciar Simulador</button>
    </div>

</div>

<!-- L√ìGICA JAVASCRIPT REFINADA -->
<script>
    // CONFIGURACI√ìN DE ESCENAS
    const scenes = {
        'start': {
            msgs: ["Andreita, ¬øqu√© hace conectada todav√≠a?", "Vea que el cuerpo necesita descanso... y diversi√≥n üòâ"],
            opts: [
                { txt: "Hola Don Ricardo. Solo termino el informe y me voy.", next: 'neutral_1', j:-5, d:0 },
                { txt: "Hola jefe, s√≠, ya estoy cansada.", next: 'friendly_1', j:0, d:0 }
            ]
        },
        'neutral_1': {
            msgs: ["Tan juiciosa siempre. Eso es lo que me gusta de usted.", "Oiga, hoy se vino muy elegante. Ese color le queda... peligroso."],
            sys: "‚ö†Ô∏è COMENTARIO INAPROPIADO SOBRE APARIENCIA",
            opts: [
                { txt: "Gracias. ¬øNecesita algo laboral?", next: 'evasive', j:-10, d:0 },
                { txt: "Ay gracias Don Ricardo.", next: 'open', j:0, d:-10 }
            ]
        },
        'friendly_1': {
            msgs: ["Pues claro. Venga le digo...", "Deber√≠amos ir a tomarnos algo para que se relaje. Yo invito, no se preocupe por la cuenta."],
            opts: [
                { txt: "Gracias, pero tengo un compromiso.", next: 'evasive', j:-5, d:0 },
                { txt: "No s√© jefe, ¬øes reuni√≥n de trabajo?", next: 'pressure', j:0, d:-5 }
            ]
        },
        'evasive': {
            msgs: ["Mmm... ya le sali√≥ el af√°n.", "No sea as√≠ de aburrida. Uno queriendo ser amable y usted con esa actitud cortante.", "Acu√©rdese que la renovaci√≥n de su contrato depende de mi visto bueno..."],
            sys: "üö® CHANTAJE / QUID PRO QUO (Zona Roja)",
            opts: [
                { txt: "¬øMe est√° amenazando con el contrato?", next: 'end_fired', j:-100, d:10 },
                { txt: "No es actitud jefe, disculpe. Ya le pongo atenci√≥n.", next: 'submission', j:-10, d:-30 }
            ]
        },
        'open': {
            msgs: ["De nada princesa.", "Usted sabe que cuenta conmigo para lo que sea. Pero necesito que sea m√°s... cari√±osa. M√°s de confianza."],
            opts: [
                { txt: "Jefe, prefiero mantener la distancia profesional.", next: 'retaliation', j:-20, d:5 },
                { txt: "¬øA qu√© se refiere?", next: 'pressure', j:0, d:-10 }
            ]
        },
        'pressure': {
            msgs: ["A que la gente inteligente sabe aprovechar las oportunidades.", "Venga a mi oficina un ratico, cerramos la puerta y revisamos ese informe con calma."],
            sys: "üö® INVITACI√ìN A ESPACIO CERRADO",
            opts: [
                { txt: "Le env√≠o el informe por correo. Hasta luego.", next: 'end_harassed', j:-50, d:10 },
                { txt: "Bueno, ya voy...", next: 'end_submission', j:10, d:-100 }
            ]
        },
        'retaliation': {
            msgs: ["Ah bueno. Si se va a poner en ese plan...", "Entonces env√≠e eso YA. Y rev√≠selo bien, porque no voy a pasar ni un solo error. Qu√© decepci√≥n."],
            opts: [
                { txt: "Entendido. Lo env√≠o ya.", next: 'end_harassed', j:0, d:0 }
            ]
        },
        'submission': {
            msgs: ["Eso, as√≠ me gusta m√°s. Sin pelear.", "La otra semana salimos entonces. Yo le aviso cu√°ndo."],
            opts: [
                { txt: "Vale...", next: 'end_submission', j:0, d:-50 }
            ]
        },
        // FINALES
        'end_fired': { isEnd: true, title: "Riesgo de Despido", text: "Al confrontarlo, √©l usar√° su poder para etiquetarte como 'conflictiva'. Aunque defendiste tu dignidad, prep√°rate para un ambiente hostil. Guarda este chat como prueba." },
        'end_harassed': { isEnd: true, title: "Acoso por Represalia", text: "Lograste poner un l√≠mite y enviar el informe, pero Ricardo ahora usar√° la 'exigencia laboral excesiva' para castigarte por haberle dicho que no." },
        'end_submission': { isEnd: true, title: "Dignidad Vulnerada", text: "Para evitar problemas, cediste. Aunque conservas el empleo hoy, has entrado en un ciclo donde √©l sentir√° que tiene derecho sobre ti. Esto afecta gravemente tu salud mental." }
    };

    // VARIABLES
    let job = 100;
    let dig = 100;
    const historyDiv = document.getElementById('chatHistory');
    const inputDiv = document.getElementById('inputZone');
    const dots = document.getElementById('typingDots');
    const chatWin = document.getElementById('chatWindow');

    // INICIAR
    setTimeout(() => playScene('start'), 1000);

    function playScene(id) {
        const scene = scenes[id];

        // CHECK FINAL
        if(scene.isEnd) {
            setTimeout(() => showEndScreen(scene), 1500);
            return;
        }

        // BLOQUEAR INPUTS
        inputDiv.innerHTML = ''; 

        // PROCESAR MENSAJES DEL JEFE
        let delay = 0;
        
        scene.msgs.forEach((txt, index) => {
            // Tiempo de espera para leer y "escribir"
            delay += 1000 + (txt.length * 20);

            // 1. Mostrar puntos
            setTimeout(() => {
                dots.style.display = 'block';
                // Mover scroll al fondo
                historyDiv.appendChild(dots); 
                historyDiv.scrollTop = historyDiv.scrollHeight;
            }, delay - 800);

            // 2. Mostrar Mensaje Real
            setTimeout(() => {
                dots.style.display = 'none'; // Ocultar puntos
                appendMsg(txt, 'boss'); // Poner mensaje
                
                // Vibraci√≥n si es el primer mensaje de la tanda
                if(index === 0) triggerVibrate();

                // Si es el √∫ltimo, mostrar opciones
                if(index === scene.msgs.length - 1) {
                    if(scene.sys) appendSysMsg(scene.sys);
                    showOptions(scene.opts);
                }
            }, delay);
        });
    }

    // AGREGAR MENSAJE (SIN BORRAR EL ANTERIOR)
    function appendMsg(text, type) {
        const div = document.createElement('div');
        div.className = `bubble b-${type}`;
        div.innerText = text;
        
        // Insertar antes de los puntos suspensivos
        historyDiv.insertBefore(div, dots);
        historyDiv.scrollTop = historyDiv.scrollHeight;
    }

    function appendSysMsg(text) {
        const div = document.createElement('div');
        div.className = 'sys-note';
        div.innerHTML = text;
        historyDiv.insertBefore(div, dots);
    }

    // MOSTRAR BOTONES
    function showOptions(opts) {
        inputDiv.innerHTML = ''; // Limpiar botones viejos
        opts.forEach(o => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = o.txt;
            btn.onclick = () => userReply(o);
            inputDiv.appendChild(btn);
        });
    }

    // RESPUESTA DEL USUARIO
    function userReply(opt) {
        // 1. Poner mi mensaje inmediatamente
        appendMsg(opt.txt, 'user');
        
        // 2. Limpiar botones para que no vuelva a clickear
        inputDiv.innerHTML = '<span style="color:#aaa; font-size:11px; text-align:center;">Esperando respuesta...</span>';

        // 3. Actualizar barras
        updateStats(opt.j, opt.d);

        // 4. Cargar siguiente escena
        if(opt.next) playScene(opt.next);
    }

    function updateStats(j, d) {
        job = Math.max(0, Math.min(100, job + j));
        dig = Math.max(0, Math.min(100, dig + d));

        document.getElementById('barJob').style.width = job + '%';
        document.getElementById('barDig').style.width = dig + '%';
        document.getElementById('txtJob').innerText = job + '%';
        document.getElementById('txtDig').innerText = dig + '%';

        // Cambiar color si es cr√≠tico
        document.getElementById('barJob').style.background = job < 40 ? '#d9534f' : '#0078d4';
        document.getElementById('barDig').style.background = dig < 40 ? '#d9534f' : '#e81123';
    }

    function triggerVibrate() {
        chatWin.classList.add('vibrate');
        setTimeout(() => chatWin.classList.remove('vibrate'), 400);
    }

    function showEndScreen(data) {
        const scr = document.getElementById('endScreen');
        scr.style.display = 'flex';
        document.getElementById('endTitle').innerText = data.title;
        document.getElementById('endDesc').innerText = data.text;
    }
</script>